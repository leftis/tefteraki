/*
Copyright (c) 2003-2012, CKSource - Frederico Knabben. All rights reserved.
For licensing, see LICENSE.html or http://ckeditor.com/license
*/
/**
 * @fileOverview Defines the {@link CKEDITOR.dom.element} class, which
 *		represents a DOM element.
 */
/**
 * Represents a DOM element.
 * @constructor
 * @augments CKEDITOR.dom.node
 * @param {Object|String} element A native DOM element or the element name for
 *		new elements.
 * @param {CKEDITOR.dom.document} [ownerDocument] The document that will contain
 *		the element in case of element creation.
 * @example
 * // Create a new &lt;span&gt; element.
 * var element = new CKEDITOR.dom.element( 'span' );
 * @example
 * // Create an element based on a native DOM element.
 * var element = new CKEDITOR.dom.element( document.getElementById( 'myId' ) );
 */
CKEDITOR.dom.element=function(e,t){typeof e=="string"&&(e=(t?t.$:document).createElement(e)),CKEDITOR.dom.domObject.call(this,e)},CKEDITOR.dom.element.get=function(e){return e&&(e.$?e:new CKEDITOR.dom.element(e))},CKEDITOR.dom.element.prototype=new CKEDITOR.dom.node,CKEDITOR.dom.element.createFromHtml=function(e,t){var n=new CKEDITOR.dom.element("div",t);return n.setHtml(e),n.getFirst().remove()},CKEDITOR.dom.element.setMarker=function(e,t,n,r){var i=t.getCustomData("list_marker_id")||t.setCustomData("list_marker_id",CKEDITOR.tools.getNextNumber()).getCustomData("list_marker_id"),s=t.getCustomData("list_marker_names")||t.setCustomData("list_marker_names",{}).getCustomData("list_marker_names");return e[i]=t,s[n]=1,t.setCustomData(n,r)},CKEDITOR.dom.element.clearAllMarkers=function(e){for(var t in e)CKEDITOR.dom.element.clearMarkers(e,e[t],1)},CKEDITOR.dom.element.clearMarkers=function(e,t,n){var r=t.getCustomData("list_marker_names"),i=t.getCustomData("list_marker_id");for(var s in r)t.removeCustomData(s);t.removeCustomData("list_marker_names"),n&&(t.removeCustomData("list_marker_id"),delete e[i])},function(){function t(e){var t=["top","left","right","bottom"],n;e=="border"&&(n=["color","style","width"]);var r=[];for(var i=0;i<t.length;i++)if(n)for(var s=0;s<n.length;s++)r.push([e,t[i],n[s]].join("-"));else r.push([e,t[i]].join("-"));return r}function n(t){var n=0;for(var r=0,i=e[t].length;r<i;r++)n+=parseInt(this.getComputedStyle(e[t][r])||0,10)||0;return n}CKEDITOR.tools.extend(CKEDITOR.dom.element.prototype,{type:CKEDITOR.NODE_ELEMENT,addClass:function(e){var t=this.$.className;if(t){var n=new RegExp("(?:^|\\s)"+e+"(?:\\s|$)","");n.test(t)||(t+=" "+e)}this.$.className=t||e},removeClass:function(e){var t=this.getAttribute("class");if(t){var n=new RegExp("(?:^|\\s+)"+e+"(?=\\s|$)","i");n.test(t)&&(t=t.replace(n,"").replace(/^\s+/,""),t?this.setAttribute("class",t):this.removeAttribute("class"))}},hasClass:function(e){var t=new RegExp("(?:^|\\s+)"+e+"(?=\\s|$)","");return t.test(this.getAttribute("class"))},append:function(e,t){return typeof e=="string"&&(e=this.getDocument().createElement(e)),t?this.$.insertBefore(e.$,this.$.firstChild):this.$.appendChild(e.$),e},appendHtml:function(e){if(!this.$.childNodes.length)this.setHtml(e);else{var t=new CKEDITOR.dom.element("div",this.getDocument());t.setHtml(e),t.moveChildren(this)}},appendText:function(e){this.$.text!=undefined?this.$.text+=e:this.append(new CKEDITOR.dom.text(e))},appendBogus:function(){var e=this.getLast();while(e&&e.type==CKEDITOR.NODE_TEXT&&!CKEDITOR.tools.rtrim(e.getText()))e=e.getPrevious();if(!e||!e.is||!e.is("br")){var t=CKEDITOR.env.opera?this.getDocument().createText(""):this.getDocument().createElement("br");CKEDITOR.env.gecko&&t.setAttribute("type","_moz"),this.append(t)}},breakParent:function(e){var t=new CKEDITOR.dom.range(this.getDocument());t.setStartAfter(this),t.setEndAfter(e);var n=t.extractContents();t.insertNode(this.remove()),n.insertAfterNode(this)},contains:CKEDITOR.env.ie||CKEDITOR.env.webkit?function(e){var t=this.$;return e.type!=CKEDITOR.NODE_ELEMENT?t.contains(e.getParent().$):t!=e.$&&t.contains(e.$)}:function(e){return!!(this.$.compareDocumentPosition(e.$)&16)},focus:function(){function e(){try{this.$.focus()}catch(e){}}return function(t){t?CKEDITOR.tools.setTimeout(e,100,this):e.call(this)}}(),getHtml:function(){var e=this.$.innerHTML;return CKEDITOR.env.ie?e.replace(/<\?[^>]*>/g,""):e},getOuterHtml:function(){if(this.$.outerHTML)return this.$.outerHTML.replace(/<\?[^>]*>/,"");var e=this.$.ownerDocument.createElement("div");return e.appendChild(this.$.cloneNode(!0)),e.innerHTML},setHtml:function(e){return this.$.innerHTML=e},setText:function(e){return CKEDITOR.dom.element.prototype.setText=this.$.innerText!=undefined?function(e){return this.$.innerText=e}:function(e){return this.$.textContent=e},this.setText(e)},getAttribute:function(){var e=function(e){return this.$.getAttribute(e,2)};return CKEDITOR.env.ie&&(CKEDITOR.env.ie7Compat||CKEDITOR.env.ie6Compat)?function(t){switch(t){case"class":t="className";break;case"http-equiv":t="httpEquiv";break;case"name":return this.$.name;case"tabindex":var n=e.call(this,t);return n!==0&&this.$.tabIndex===0&&(n=null),n;case"checked":var r=this.$.attributes.getNamedItem(t),i=r.specified?r.nodeValue:this.$.checked;return i?"checked":null;case"hspace":case"value":return this.$[t];case"style":return this.$.style.cssText;case"contenteditable":case"contentEditable":return this.$.attributes.getNamedItem("contentEditable").specified?this.$.getAttribute("contentEditable"):null}return e.call(this,t)}:e}(),getChildren:function(){return new CKEDITOR.dom.nodeList(this.$.childNodes)},getComputedStyle:CKEDITOR.env.ie?function(e){return this.$.currentStyle[CKEDITOR.tools.cssStyleToDomStyle(e)]}:function(e){var t=this.getWindow().$.getComputedStyle(this.$,null);return t?t.getPropertyValue(e):""},getDtd:function(){var e=CKEDITOR.dtd[this.getName()];return this.getDtd=function(){return e},e},getElementsByTag:CKEDITOR.dom.document.prototype.getElementsByTag,getTabIndex:CKEDITOR.env.ie?function(){var e=this.$.tabIndex;return e===0&&!CKEDITOR.dtd.$tabIndex[this.getName()]&&parseInt(this.getAttribute("tabindex"),10)!==0&&(e=-1),e}:CKEDITOR.env.webkit?function(){var e=this.$.tabIndex;return e==undefined&&(e=parseInt(this.getAttribute("tabindex"),10),isNaN(e)&&(e=-1)),e}:function(){return this.$.tabIndex},getText:function(){return this.$.textContent||this.$.innerText||""},getWindow:function(){return this.getDocument().getWindow()},getId:function(){return this.$.id||null},getNameAtt:function(){return this.$.name||null},getName:function(){var e=this.$.nodeName.toLowerCase();if(CKEDITOR.env.ie&&!(document.documentMode>8)){var t=this.$.scopeName;t!="HTML"&&(e=t.toLowerCase()+":"+e)}return(this.getName=function(){return e})()},getValue:function(){return this.$.value},getFirst:function(e){var t=this.$.firstChild,n=t&&new CKEDITOR.dom.node(t);return n&&e&&!e(n)&&(n=n.getNext(e)),n},getLast:function(e){var t=this.$.lastChild,n=t&&new CKEDITOR.dom.node(t);return n&&e&&!e(n)&&(n=n.getPrevious(e)),n},getStyle:function(e){return this.$.style[CKEDITOR.tools.cssStyleToDomStyle(e)]},is:function(){var e=this.getName();for(var t=0;t<arguments.length;t++)if(arguments[t]==e)return!0;return!1},isEditable:function(e){var t=this.getName();if(this.isReadOnly()||this.getComputedStyle("display")=="none"||this.getComputedStyle("visibility")=="hidden"||this.is("a")&&this.data("cke-saved-name")&&!this.getChildCount()||CKEDITOR.dtd.$nonEditable[t]||CKEDITOR.dtd.$empty[t])return!1;if(e!==!1){var n=CKEDITOR.dtd[t]||CKEDITOR.dtd.span;return n&&n["#"]}return!0},isIdentical:function(e){if(this.getName()!=e.getName())return!1;var t=this.$.attributes,n=e.$.attributes,r=t.length,i=n.length;for(var s=0;s<r;s++){var o=t[s];if(o.nodeName=="_moz_dirty")continue;if((!CKEDITOR.env.ie||o.specified&&o.nodeName!="data-cke-expando")&&o.nodeValue!=e.getAttribute(o.nodeName))return!1}if(CKEDITOR.env.ie)for(s=0;s<i;s++){o=n[s];if(o.specified&&o.nodeName!="data-cke-expando"&&o.nodeValue!=this.getAttribute(o.nodeName))return!1}return!0},isVisible:function(){var e=(this.$.offsetHeight||this.$.offsetWidth)&&this.getComputedStyle("visibility")!="hidden",t,n;return e&&(CKEDITOR.env.webkit||CKEDITOR.env.opera)&&(t=this.getWindow(),!t.equals(CKEDITOR.document.getWindow())&&(n=t.$.frameElement)&&(e=(new CKEDITOR.dom.element(n)).isVisible())),!!e},isEmptyInlineRemoveable:function(){if(!CKEDITOR.dtd.$removeEmpty[this.getName()])return!1;var e=this.getChildren();for(var t=0,n=e.count();t<n;t++){var r=e.getItem(t);if(r.type==CKEDITOR.NODE_ELEMENT&&r.data("cke-bookmark"))continue;if(r.type==CKEDITOR.NODE_ELEMENT&&!r.isEmptyInlineRemoveable()||r.type==CKEDITOR.NODE_TEXT&&CKEDITOR.tools.trim(r.getText()))return!1}return!0},hasAttributes:CKEDITOR.env.ie&&(CKEDITOR.env.ie7Compat||CKEDITOR.env.ie6Compat)?function(){var e=this.$.attributes;for(var t=0;t<e.length;t++){var n=e[t];switch(n.nodeName){case"class":if(this.getAttribute("class"))return!0;case"data-cke-expando":continue;default:if(n.specified)return!0}}return!1}:function(){var e=this.$.attributes,t=e.length,n={"data-cke-expando":1,_moz_dirty:1};return t>0&&(t>2||!n[e[0].nodeName]||t==2&&!n[e[1].nodeName])},hasAttribute:function(){function e(e){var t=this.$.attributes.getNamedItem(e);return!!t&&!!t.specified}return CKEDITOR.env.ie&&CKEDITOR.env.version<8?function(t){return t=="name"?!!this.$.name:e.call(this,t)}:e}(),hide:function(){this.setStyle("display","none")},moveChildren:function(e,t){var n=this.$;e=e.$;if(n==e)return;var r;if(t)while(r=n.lastChild)e.insertBefore(n.removeChild(r),e.firstChild);else while(r=n.firstChild)e.appendChild(n.removeChild(r))},mergeSiblings:function(){function e(e,t,n){if(t&&t.type==CKEDITOR.NODE_ELEMENT){var r=[];while(t.data("cke-bookmark")||t.isEmptyInlineRemoveable()){r.push(t),t=n?t.getNext():t.getPrevious();if(!t||t.type!=CKEDITOR.NODE_ELEMENT)return}if(e.isIdentical(t)){var i=n?e.getLast():e.getFirst();while(r.length)r.shift().move(e,!n);t.moveChildren(e,!n),t.remove(),i&&i.type==CKEDITOR.NODE_ELEMENT&&i.mergeSiblings()}}}return function(t){if(t!==!1&&!CKEDITOR.dtd.$removeEmpty[this.getName()]&&!this.is("a"))return;e(this,this.getNext(),!0),e(this,this.getPrevious())}}(),show:function(){this.setStyles({display:"",visibility:""})},setAttribute:function(){var e=function(e,t){return this.$.setAttribute(e,t),this};return CKEDITOR.env.ie&&(CKEDITOR.env.ie7Compat||CKEDITOR.env.ie6Compat)?function(t,n){return t=="class"?this.$.className=n:t=="style"?this.$.style.cssText=n:t=="tabindex"?this.$.tabIndex=n:t=="checked"?this.$.checked=n:t=="contenteditable"?e.call(this,"contentEditable",n):e.apply(this,arguments),this}:CKEDITOR.env.ie8Compat&&CKEDITOR.env.secure?function(t,n){if(t=="src"&&n.match(/^http:\/\//))try{e.apply(this,arguments)}catch(r){}else e.apply(this,arguments);return this}:e}(),setAttributes:function(e){for(var t in e)this.setAttribute(t,e[t]);return this},setValue:function(e){return this.$.value=e,this},removeAttribute:function(){var e=function(e){this.$.removeAttribute(e)};return CKEDITOR.env.ie&&(CKEDITOR.env.ie7Compat||CKEDITOR.env.ie6Compat)?function(t){t=="class"?t="className":t=="tabindex"?t="tabIndex":t=="contenteditable"&&(t="contentEditable"),e.call(this,t)}:e}(),removeAttributes:function(e){if(CKEDITOR.tools.isArray(e))for(var t=0;t<e.length;t++)this.removeAttribute(e[t]);else for(var n in e)e.hasOwnProperty(n)&&this.removeAttribute(n)},removeStyle:function(e){var n=this.$.style;if(!n.removeProperty&&(e=="border"||e=="margin"||e=="padding")){var r=t(e);for(var i=0;i<r.length;i++)this.removeStyle(r[i]);return}n.removeProperty?n.removeProperty(e):n.removeAttribute(CKEDITOR.tools.cssStyleToDomStyle(e)),this.$.style.cssText||this.removeAttribute("style")},setStyle:function(e,t){return this.$.style[CKEDITOR.tools.cssStyleToDomStyle(e)]=t,this},setStyles:function(e){for(var t in e)this.setStyle(t,e[t]);return this},setOpacity:function(e){CKEDITOR.env.ie&&CKEDITOR.env.version<9?(e=Math.round(e*100),this.setStyle("filter",e>=100?"":"progid:DXImageTransform.Microsoft.Alpha(opacity="+e+")")):this.setStyle("opacity",e)},unselectable:CKEDITOR.env.gecko?function(){this.$.style.MozUserSelect="none",this.on("dragstart",function(e){e.data.preventDefault()})}:CKEDITOR.env.webkit?function(){this.$.style.KhtmlUserSelect="none",this.on("dragstart",function(e){e.data.preventDefault()})}:function(){if(CKEDITOR.env.ie||CKEDITOR.env.opera){var e=this.$,t=e.getElementsByTagName("*"),n,r=0;e.unselectable="on";while(n=t[r++])switch(n.tagName.toLowerCase()){case"iframe":case"textarea":case"input":case"select":break;default:n.unselectable="on"}}},getPositionedAncestor:function(){var e=this;while(e.getName()!="html"){if(e.getComputedStyle("position")!="static")return e;e=e.getParent()}return null},getDocumentPosition:function(e){var t=0,n=0,r=this.getDocument(),i=r.getBody(),s=r.$.compatMode=="BackCompat";if(document.documentElement.getBoundingClientRect){var o=this.$.getBoundingClientRect(),u=r.$,a=u.documentElement,f=a.clientTop||i.$.clientTop||0,l=a.clientLeft||i.$.clientLeft||0,c=!0;if(CKEDITOR.env.ie){var h=r.getDocumentElement().contains(this),p=r.getBody().contains(this);c=s&&p||!s&&h}c&&(t=o.left+(!s&&a.scrollLeft||i.$.scrollLeft),t-=l,n=o.top+(!s&&a.scrollTop||i.$.scrollTop),n-=f)}else{var d=this,v=null,m;while(d&&d.getName()!="body"&&d.getName()!="html"){t+=d.$.offsetLeft-d.$.scrollLeft,n+=d.$.offsetTop-d.$.scrollTop,d.equals(this)||(t+=d.$.clientLeft||0,n+=d.$.clientTop||0);var g=v;while(g&&!g.equals(d))t-=g.$.scrollLeft,n-=g.$.scrollTop,g=g.getParent();v=d,d=(m=d.$.offsetParent)?new CKEDITOR.dom.element(m):null}}if(e){var y=this.getWindow(),b=e.getWindow();if(!y.equals(b)&&y.$.frameElement){var w=(new CKEDITOR.dom.element(y.$.frameElement)).getDocumentPosition(e);t+=w.x,n+=w.y}}return document.documentElement.getBoundingClientRect||CKEDITOR.env.gecko&&!s&&(t+=this.$.clientLeft?1:0,n+=this.$.clientTop?1:0),{x:t,y:n}},scrollIntoView:function(e){var t=this.getParent();if(!t)return;do{var n=t.$.clientWidth&&t.$.clientWidth<t.$.scrollWidth||t.$.clientHeight&&t.$.clientHeight<t.$.scrollHeight;n&&this.scrollIntoParent(t,e,1);if(t.is("html")){var r=t.getWindow();try{var i=r.$.frameElement;i&&(t=new CKEDITOR.dom.element(i))}catch(s){}}}while(t=t.getParent())},scrollIntoParent:function(e,t,n){function s(t,n){/body|html/.test(e.getName())?e.getWindow().$.scrollBy(t,n):(e.$.scrollLeft+=t,e.$.scrollTop+=n)}function o(e,t){var n={x:0,y:0};if(!e.is(i?"body":"html")){var r=e.$.getBoundingClientRect();n.x=r.left,n.y=r.top}var s=e.getWindow();if(!s.equals(t)){var u=o(CKEDITOR.dom.element.get(s.$.frameElement),t);n.x+=u.x,n.y+=u.y}return n}function u(e,t){return parseInt(e.getComputedStyle("margin-"+t)||0,10)||0}!e&&(e=this.getWindow());var r=e.getDocument(),i=r.$.compatMode=="BackCompat";e instanceof CKEDITOR.dom.window&&(e=i?r.getBody():r.getDocumentElement());var a=e.getWindow(),f=o(this,a),l=o(e,a),c=this.$.offsetHeight,h=this.$.offsetWidth,p=e.$.clientHeight,d=e.$.clientWidth,v,m;v={x:f.x-u(this,"left")-l.x||0,y:f.y-u(this,"top")-l.y||0},m={x:f.x+h+u(this,"right")-(l.x+d)||0,y:f.y+c+u(this,"bottom")-(l.y+p)||0},(v.y<0||m.y>0)&&s(0,t===!0?v.y:t===!1?m.y:v.y<0?v.y:m.y),n&&(v.x<0||m.x>0)&&s(v.x<0?v.x:m.x,0)},setState:function(e){switch(e){case CKEDITOR.TRISTATE_ON:this.addClass("cke_on"),this.removeClass("cke_off"),this.removeClass("cke_disabled");break;case CKEDITOR.TRISTATE_DISABLED:this.addClass("cke_disabled"),this.removeClass("cke_off"),this.removeClass("cke_on");break;default:this.addClass("cke_off"),this.removeClass("cke_on"),this.removeClass("cke_disabled")}},getFrameDocument:function(){var e=this.$;try{e.contentWindow.document}catch(t){e.src=e.src,CKEDITOR.env.ie&&CKEDITOR.env.version<7&&window.showModalDialog('javascript:document.write("<script>window.setTimeout(function(){window.close();},50);</script>")')}return e&&new CKEDITOR.dom.document(e.contentWindow.document)},copyAttributes:function(e,t){var n=this.$.attributes;t=t||{};for(var r=0;r<n.length;r++){var i=n[r],s=i.nodeName.toLowerCase(),o;if(s in t)continue;if(s=="checked"&&(o=this.getAttribute(s)))e.setAttribute(s,o);else if(i.specified||CKEDITOR.env.ie&&i.nodeValue&&s=="value")o=this.getAttribute(s),o===null&&(o=i.nodeValue),e.setAttribute(s,o)}this.$.style.cssText!==""&&(e.$.style.cssText=this.$.style.cssText)},renameNode:function(e){if(this.getName()==e)return;var t=this.getDocument(),n=new CKEDITOR.dom.element(e,t);this.copyAttributes(n),this.moveChildren(n),this.getParent()&&this.$.parentNode.replaceChild(n.$,this.$),n.$["data-cke-expando"]=this.$["data-cke-expando"],this.$=n.$},getChild:function(e){var t=this.$;if(!e.slice)t=t.childNodes[e];else while(e.length>0&&t)t=t.childNodes[e.shift()];return t?new CKEDITOR.dom.node(t):null},getChildCount:function(){return this.$.childNodes.length},disableContextMenu:function(){this.on("contextmenu",function(e){e.data.getTarget().hasClass("cke_enable_context_menu")||e.data.preventDefault()})},getDirection:function(e){return e?this.getComputedStyle("direction")||this.getDirection()||this.getDocument().$.dir||this.getDocument().getBody().getDirection(1):this.getStyle("direction")||this.getAttribute("dir")},data:function(e,t){return e="data-"+e,t===undefined?this.getAttribute(e):(t===!1?this.removeAttribute(e):this.setAttribute(e,t),null)}});var e={width:["border-left-width","border-right-width","padding-left","padding-right"],height:["border-top-width","border-bottom-width","padding-top","padding-bottom"]};CKEDITOR.dom.element.prototype.setSize=function(e,t,r){typeof t=="number"&&(r&&(!CKEDITOR.env.ie||!CKEDITOR.env.quirks)&&(t-=n.call(this,e)),this.setStyle(e,t+"px"))},CKEDITOR.dom.element.prototype.getSize=function(e,t){var r=Math.max(this.$["offset"+CKEDITOR.tools.capitalize(e)],this.$["client"+CKEDITOR.tools.capitalize(e)])||0;return t&&(r-=n.call(this,e)),r}}();