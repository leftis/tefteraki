/*
Copyright (c) 2003-2012, CKSource - Frederico Knabben. All rights reserved.
For licensing, see LICENSE.html or http://ckeditor.com/license
*/
(function(){function t(e,t,n){var r=e.serializable,i=t[n?"endContainer":"startContainer"],s=n?"endOffset":"startOffset",o=r?t.document.getById(e.startNode):e.startNode,u=r?t.document.getById(e.endNode):e.endNode;return i.equals(o.getPrevious())?(t.startOffset=t.startOffset-i.getLength()-u.getPrevious().getLength(),i=u.getNext()):i.equals(u.getPrevious())&&(t.startOffset=t.startOffset-i.getLength(),i=u.getNext()),i.equals(o.getParent())&&t[s]++,i.equals(u.getParent())&&t[s]++,t[n?"endContainer":"startContainer"]=i,t}CKEDITOR.dom.rangeList=function(t){return t instanceof CKEDITOR.dom.rangeList?t:(t?t instanceof CKEDITOR.dom.range&&(t=[t]):t=[],CKEDITOR.tools.extend(t,e))};var e={createIterator:function(){var e=this,t=CKEDITOR.dom.walker.bookmark(),n=function(e){return!e.is||!e.is("tr")},r=[],i;return{getNextRange:function(n){i=i==undefined?0:i+1;var s=e[i];if(s&&e.length>1){if(!i)for(var o=e.length-1;o>=0;o--)r.unshift(e[o].createBookmark(!0));if(n){var u=0;while(e[i+u+1]){var a=s.document,f=0,l=a.getById(r[u].endNode),c=a.getById(r[u+1].startNode),h;for(;;){h=l.getNextSourceNode(!1);if(!c.equals(h)){if(t(h)||h.type==CKEDITOR.NODE_ELEMENT&&h.isBlockBoundary()){l=h;continue}}else f=1;break}if(!f)break;u++}}s.moveToBookmark(r.shift());while(u--)h=e[++i],h.moveToBookmark(r.shift()),s.setEnd(h.endContainer,h.endOffset)}return s}}},createBookmarks:function(e){var n=[],r;for(var i=0;i<this.length;i++){n.push(r=this[i].createBookmark(e,!0));for(var s=i+1;s<this.length;s++)this[s]=t(r,this[s]),this[s]=t(r,this[s],!0)}return n},createBookmarks2:function(e){var t=[];for(var n=0;n<this.length;n++)t.push(this[n].createBookmark2(e));return t},moveToBookmarks:function(e){for(var t=0;t<this.length;t++)this[t].moveToBookmark(e[t])}}})();