/*
Copyright (c) 2003-2012, CKSource - Frederico Knabben. All rights reserved.
For licensing, see LICENSE.html or http://ckeditor.com/license
*/
CKEDITOR.plugins.add("contextmenu",{requires:["menu"],onLoad:function(){CKEDITOR.plugins.contextMenu=CKEDITOR.tools.createClass({base:CKEDITOR.menu,$:function(e){this.base.call(this,e,{panel:{className:e.skinClass+" cke_contextmenu",attributes:{"aria-label":e.lang.contextmenu.options}}})},proto:{addTarget:function(e,t){if(CKEDITOR.env.opera&&!("oncontextmenu"in document.body)){var n;e.on("mousedown",function(r){r=r.data;if(r.$.button!=2){r.getKeystroke()==CKEDITOR.CTRL+1&&e.fire("contextmenu",r);return}if(t&&(CKEDITOR.env.mac?r.$.metaKey:r.$.ctrlKey))return;var i=r.getTarget();if(!n){var s=i.getDocument();n=s.createElement("input"),n.$.type="button",s.getBody().append(n)}n.setAttribute("style","position:absolute;top:"+(r.$.clientY-2)+"px;left:"+(r.$.clientX-2)+"px;width:5px;height:5px;opacity:0.01")}),e.on("mouseup",function(t){n&&(n.remove(),n=undefined,e.fire("contextmenu",t.data))})}e.on("contextmenu",function(e){var n=e.data;if(t&&(CKEDITOR.env.webkit?r:CKEDITOR.env.mac?n.$.metaKey:n.$.ctrlKey))return;n.preventDefault();var i=n.getTarget().getDocument().getDocumentElement(),s=n.$.clientX,o=n.$.clientY;CKEDITOR.tools.setTimeout(function(){this.open(i,null,s,o)},CKEDITOR.env.ie?200:0,this)},this),CKEDITOR.env.opera&&e.on("keypress",function(e){var t=e.data;t.$.keyCode===0&&t.preventDefault()});if(CKEDITOR.env.webkit){var r,i=function(e){r=CKEDITOR.env.mac?e.data.$.metaKey:e.data.$.ctrlKey},s=function(){r=0};e.on("keydown",i),e.on("keyup",s),e.on("contextmenu",s)}},open:function(e,t,n,r){this.editor.focus(),e=e||CKEDITOR.document.getDocumentElement(),this.show(e,t,n,r)}}})},beforeInit:function(e){e.contextMenu=new CKEDITOR.plugins.contextMenu(e),e.addCommand("contextMenu",{exec:function(){e.contextMenu.open(e.document.getBody())}})}});