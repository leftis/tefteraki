/*
 * Copyright (c) 2003-2012, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.html or http://ckeditor.com/license
 */
(function(){function e(e,t,n){if(!t.is||!t.getCustomData("block_processed"))t.is&&CKEDITOR.dom.element.setMarker(n,t,"block_processed",!0),e.push(t)}function t(e){var t=[],n=e.getChildren();for(var r=0;r<n.count();r++){var i=n.getItem(r);(i.type!==CKEDITOR.NODE_TEXT||!/^[ \t\n\r]+$/.test(i.getText()))&&t.push(i)}return t}function n(t,n){function s(e){var t=(new CKEDITOR.dom.elementPath(e)).elements,n;for(var i=0;i<t.length;i++)if(t[i].getName()in r){n=t[i];break}return n}function o(){this.foreach(function(e){/^(?!vbox|hbox)/.test(e.type)&&(e.setup||(e.setup=function(t){e.setValue(t.getAttribute(e.id)||"")}),e.commit||(e.commit=function(t){var n=this.getValue();if("dir"==e.id&&t.getComputedStyle("direction")==n)return;n?t.setAttribute(e.id,n):t.removeAttribute(e.id)}))})}function u(t){var n=[],s={},o=[],u,a=t.document.getSelection(),l=a.getRanges(),c=a.createBookmarks(),h,p,d=t.config.enterMode==CKEDITOR.ENTER_DIV?"div":"p";for(h=0;h<l.length;h++){p=l[h].createIterator();while(u=p.getNextParagraph())if(u.getName()in r){var v,m=u.getChildren();for(v=0;v<m.count();v++)e(o,m.getItem(v),s)}else{while(!i[u.getName()]&&u.getName()!="body")u=u.getParent();e(o,u,s)}}CKEDITOR.dom.element.clearAllMarkers(s);var g=f(o),y,b,w;for(h=0;h<g.length;h++){var E=g[h][0];y=E.getParent();for(v=1;v<g[h].length;v++)y=y.getCommonAncestor(g[h][v]);w=new CKEDITOR.dom.element("div",t.document);for(v=0;v<g[h].length;v++){E=g[h][v];while(!E.getParent().equals(y))E=E.getParent();g[h][v]=E}var S=null;for(v=0;v<g[h].length;v++){E=g[h][v];if(!E.getCustomData||!E.getCustomData("block_processed"))E.is&&CKEDITOR.dom.element.setMarker(s,E,"block_processed",!0),v||w.insertBefore(E),w.append(E)}CKEDITOR.dom.element.clearAllMarkers(s),n.push(w)}return a.selectBookmarks(c),n}function a(e){var t=new CKEDITOR.dom.elementPath(e.getSelection().getStartElement()),n=t.blockLimit,r=n&&n.getAscendant("div",!0);return r}function f(e){var t=[],n=null,r,i;for(var o=0;o<e.length;o++){i=e[o];var u=s(i);u.equals(n)||(n=u,t.push([])),t[t.length-1].push(i)}return t}function l(e){var n=this.getDialog(),r=n._element&&n._element.clone()||new CKEDITOR.dom.element("div",t.document);this.commit(r,!0),e=[].concat(e);var i=e.length,s;for(var o=0;o<i;o++)s=n.getContentElement.apply(n,e[o].split(":")),s&&s.setup&&s.setup(r,!0)}var r=function(){var e=CKEDITOR.tools.extend({},CKEDITOR.dtd.$blockLimit);return delete e.div,t.config.div_wrapTable&&(delete e.td,delete e.th),e}(),i=CKEDITOR.dtd.div,c={},h=[];return{title:t.lang.div.title,minWidth:400,minHeight:165,contents:[{id:"info",label:t.lang.common.generalTab,title:t.lang.common.generalTab,elements:[{type:"hbox",widths:["50%","50%"],children:[{id:"elementStyle",type:"select",style:"width: 100%;",label:t.lang.div.styleSelectLabel,"default":"",items:[[t.lang.common.notSet,""]],onChange:function(){l.call(this,["info:class","advanced:dir","advanced:style"])},setup:function(e){for(var t in c)c[t].checkElementRemovable(e,!0)&&this.setValue(t)},commit:function(e){var t;if(t=this.getValue()){var n=c[t],r=e.getCustomData("elementStyle")||"";n.applyToObject(e),e.setCustomData("elementStyle",r+n._.definition.attributes.style)}}},{id:"class",type:"text",label:t.lang.common.cssClass,"default":""}]}]},{id:"advanced",label:t.lang.common.advancedTab,title:t.lang.common.advancedTab,elements:[{type:"vbox",padding:1,children:[{type:"hbox",widths:["50%","50%"],children:[{type:"text",id:"id",label:t.lang.common.id,"default":""},{type:"text",id:"lang",label:t.lang.link.langCode,"default":""}]},{type:"hbox",children:[{type:"text",id:"style",style:"width: 100%;",label:t.lang.common.cssStyle,"default":"",commit:function(e){var t=this.getValue()+(e.getCustomData("elementStyle")||"");e.setAttribute("style",t)}}]},{type:"hbox",children:[{type:"text",id:"title",style:"width: 100%;",label:t.lang.common.advisoryTitle,"default":""}]},{type:"select",id:"dir",style:"width: 100%;",label:t.lang.common.langDir,"default":"",items:[[t.lang.common.notSet,""],[t.lang.common.langDirLtr,"ltr"],[t.lang.common.langDirRtl,"rtl"]]}]}]}],onLoad:function(){o.call(this);var e=this,n=this.getContentElement("info","elementStyle");t.getStylesSet(function(t){var r;if(t)for(var i=0;i<t.length;i++){var s=t[i];s.element&&s.element=="div"&&(r=s.name,c[r]=new CKEDITOR.style(s),n.items.push([r,r]),n.add(r,r))}n[n.items.length>1?"enable":"disable"](),setTimeout(function(){n.setup(e._element)},0)})},onShow:function(){if(n=="editdiv"){var e=a(t);e&&this.setupContent(this._element=e)}},onOk:function(){n=="editdiv"?h=[this._element]:h=u(t,!0);var e=h.length;for(var r=0;r<e;r++)this.commitContent(h[r]),!h[r].getAttribute("style")&&h[r].removeAttribute("style");this.hide()},onHide:function(){n=="editdiv"&&this._element.removeCustomData("elementStyle"),delete this._element}}}CKEDITOR.dialog.add("creatediv",function(e){return n(e,"creatediv")}),CKEDITOR.dialog.add("editdiv",function(e){return n(e,"editdiv")})})();