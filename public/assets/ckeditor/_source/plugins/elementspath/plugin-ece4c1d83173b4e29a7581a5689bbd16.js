/*
Copyright (c) 2003-2012, CKSource - Frederico Knabben. All rights reserved.
For licensing, see LICENSE.html or http://ckeditor.com/license
*/
/**
 * @fileOverview The "elementspath" plugin. It shows all elements in the DOM
 *		parent tree relative to the current selection in the editing area.
 */
(function(){var e={toolbarFocus:{editorFocus:!1,readOnly:1,exec:function(e){var t=e._.elementsPath.idBase,n=CKEDITOR.document.getById(t+"0");n&&n.focus(CKEDITOR.env.ie||CKEDITOR.env.air)}}},t='<span class="cke_empty">&nbsp;</span>';CKEDITOR.plugins.add("elementspath",{requires:["selection"],init:function(n){function u(e){n.focus();var t=n._.elementsPath.list[e];if(t.is("body")){var r=new CKEDITOR.dom.range(n.document);r.selectNodeContents(t),r.select()}else n.getSelection().selectElement(t)}function l(){i&&i.setHtml(t),delete n._.elementsPath.list}var r="cke_path_"+n.name,i,s=function(){return i||(i=CKEDITOR.document.getById(r)),i},o="cke_elementspath_"+CKEDITOR.tools.getNextNumber()+"_";n._.elementsPath={idBase:o,filters:[]},n.on("themeSpace",function(e){e.data.space=="bottom"&&(e.data.html+='<span id="'+r+'_label" class="cke_voice_label">'+n.lang.elementsPath.eleLabel+"</span>"+'<div id="'+r+'" class="cke_path" role="group" aria-labelledby="'+r+'_label">'+t+"</div>")});var a=CKEDITOR.tools.addFunction(u),f=CKEDITOR.tools.addFunction(function(e,t){var r=n._.elementsPath.idBase,i;t=new CKEDITOR.dom.event(t);var s=n.lang.dir=="rtl";switch(t.getKeystroke()){case s?39:37:case 9:return i=CKEDITOR.document.getById(r+(e+1)),i||(i=CKEDITOR.document.getById(r+"0")),i.focus(),!1;case s?37:39:case CKEDITOR.SHIFT+9:return i=CKEDITOR.document.getById(r+(e-1)),i||(i=CKEDITOR.document.getById(r+(n._.elementsPath.list.length-1))),i.focus(),!1;case 27:return n.focus(),!1;case 13:case 32:return u(e),!1}return!0});n.on("selectionChange",function(e){var n=CKEDITOR.env,r=e.data.selection,i=r.getStartElement(),u=[],l=e.editor,c=l._.elementsPath.list=[],h=l._.elementsPath.filters;while(i){var p=0,d;i.data("cke-display-name")?d=i.data("cke-display-name"):i.data("cke-real-element-type")?d=i.data("cke-real-element-type"):d=i.getName();for(var v=0;v<h.length;v++){var m=h[v](i,d);if(m===!1){p=1;break}d=m||d}if(!p){var g=c.push(i)-1,y="";if(n.opera||n.gecko&&n.mac)y+=' onkeypress="return false;"';n.gecko&&(y+=' onblur="this.style.cssText = this.style.cssText;"');var b=l.lang.elementsPath.eleTitle.replace(/%1/,d);u.unshift('<a id="',o,g,'" href="javascript:void(\'',d,'\')" tabindex="-1" title="',b,'"'+(CKEDITOR.env.gecko&&CKEDITOR.env.version<10900?' onfocus="event.preventBubble();"':"")+' hidefocus="true" '+' onkeydown="return CKEDITOR.tools.callFunction(',f,",",g,', event );"'+y,' onclick="CKEDITOR.tools.callFunction('+a,",",g,'); return false;"',' role="button" aria-labelledby="'+o+g+'_label">',d,'<span id="',o,g,'_label" class="cke_label">'+b+"</span>","</a>")}if(d=="body")break;i=i.getParent()}var w=s();w.setHtml(u.join("")+t),l.fire("elementsPathUpdate",{space:w})}),n.on("readOnly",l),n.on("contentDomUnload",l),n.addCommand("elementsPathFocus",e.toolbarFocus)}})})();