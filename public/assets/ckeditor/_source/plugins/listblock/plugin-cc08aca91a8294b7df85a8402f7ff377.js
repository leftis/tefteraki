/*
Copyright (c) 2003-2012, CKSource - Frederico Knabben. All rights reserved.
For licensing, see LICENSE.html or http://ckeditor.com/license
*/
CKEDITOR.plugins.add("listblock",{requires:["panel"],onLoad:function(){CKEDITOR.ui.panel.prototype.addListBlock=function(e,t){return this.addBlock(e,new CKEDITOR.ui.listBlock(this.getHolderElement(),t))},CKEDITOR.ui.listBlock=CKEDITOR.tools.createClass({base:CKEDITOR.ui.panel.block,$:function(e,t){t=t||{};var n=t.attributes||(t.attributes={});(this.multiSelect=!!t.multiSelect)&&(n["aria-multiselectable"]=!0),!n.role&&(n.role="listbox"),this.base.apply(this,arguments);var r=this.keys;r[40]="next",r[9]="next",r[38]="prev",r[CKEDITOR.SHIFT+9]="prev",r[32]=CKEDITOR.env.ie?"mouseup":"click",CKEDITOR.env.ie&&(r[13]="mouseup"),this._.pendingHtml=[],this._.items={},this._.groups={}},_:{close:function(){this._.started&&(this._.pendingHtml.push("</ul>"),delete this._.started)},getClick:function(){return this._.click||(this._.click=CKEDITOR.tools.addFunction(function(e){var t=!0;this.multiSelect?t=this.toggle(e):this.mark(e),this.onClick&&this.onClick(e,t)},this)),this._.click}},proto:{add:function(e,t,n){var r=this._.pendingHtml,i=CKEDITOR.tools.getNextId();this._.started||(r.push('<ul role="presentation" class=cke_panel_list>'),this._.started=1,this._.size=this._.size||0),this._.items[e]=i,r.push("<li id=",i,' class=cke_panel_listItem role=presentation><a id="',i,'_option" _cke_focus=1 hidefocus=true title="',n||e,'" href="javascript:void(\'',e,"')\" "+(CKEDITOR.env.ie?'onclick="return false;" onmouseup':"onclick")+'="CKEDITOR.tools.callFunction(',this._.getClick(),",'",e,"'); return false;\"",' role="option">',t||e,"</a></li>")},startGroup:function(e){this._.close();var t=CKEDITOR.tools.getNextId();this._.groups[e]=t,this._.pendingHtml.push('<h1 role="presentation" id=',t," class=cke_panel_grouptitle>",e,"</h1>")},commit:function(){this._.close(),this.element.appendHtml(this._.pendingHtml.join("")),delete this._.size,this._.pendingHtml=[]},toggle:function(e){var t=this.isMarked(e);return t?this.unmark(e):this.mark(e),!t},hideGroup:function(e){var t=this.element.getDocument().getById(this._.groups[e]),n=t&&t.getNext();t&&(t.setStyle("display","none"),n&&n.getName()=="ul"&&n.setStyle("display","none"))},hideItem:function(e){this.element.getDocument().getById(this._.items[e]).setStyle("display","none")},showAll:function(){var e=this._.items,t=this._.groups,n=this.element.getDocument();for(var r in e)n.getById(e[r]).setStyle("display","");for(var i in t){var s=n.getById(t[i]),o=s.getNext();s.setStyle("display",""),o&&o.getName()=="ul"&&o.setStyle("display","")}},mark:function(e){this.multiSelect||this.unmarkAll();var t=this._.items[e],n=this.element.getDocument().getById(t);n.addClass("cke_selected"),this.element.getDocument().getById(t+"_option").setAttribute("aria-selected",!0),this.onMark&&this.onMark(n)},unmark:function(e){var t=this.element.getDocument(),n=this._.items[e],r=t.getById(n);r.removeClass("cke_selected"),t.getById(n+"_option").removeAttribute("aria-selected"),this.onUnmark&&this.onUnmark(r)},unmarkAll:function(){var e=this._.items,t=this.element.getDocument();for(var n in e){var r=e[n];t.getById(r).removeClass("cke_selected"),t.getById(r+"_option").removeAttribute("aria-selected")}this.onUnmark&&this.onUnmark()},isMarked:function(e){return this.element.getDocument().getById(this._.items[e]).hasClass("cke_selected")},focus:function(e){this._.focusIndex=-1;if(e){var t=this.element.getDocument().getById(this._.items[e]).getFirst(),n=this.element.getElementsByTag("a"),r,i=-1;while(r=n.getItem(++i))if(r.equals(t)){this._.focusIndex=i;break}setTimeout(function(){t.focus()},0)}}}})}});