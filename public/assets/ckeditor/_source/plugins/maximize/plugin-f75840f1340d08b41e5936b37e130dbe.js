/*
Copyright (c) 2003-2012, CKSource - Frederico Knabben. All rights reserved.
For licensing, see LICENSE.html or http://ckeditor.com/license
*/
(function(){function e(e){if(!e||e.type!=CKEDITOR.NODE_ELEMENT||e.getName()!="form")return[];var t=[],n=["style","className"];for(var r=0;r<n.length;r++){var i=n[r],s=e.$.elements.namedItem(i);if(s){var o=new CKEDITOR.dom.element(s);t.push([o,o.nextSibling]),o.remove()}}return t}function t(e,t){if(!e||e.type!=CKEDITOR.NODE_ELEMENT||e.getName()!="form")return;if(t.length>0)for(var n=t.length-1;n>=0;n--){var r=t[n][0],i=t[n][1];i?r.insertBefore(i):r.appendTo(e)}}function n(n,r){var i=e(n),s={},o=n.$;return r||(s["class"]=o.className||"",o.className=""),s.inline=o.style.cssText||"",r||(o.style.cssText="position: static; overflow: visible"),t(i),s}function r(n,r){var i=e(n),s=n.$;"class"in r&&(s.className=r["class"]),"inline"in r&&(s.style.cssText=r.inline),t(i)}function i(e){var t=CKEDITOR.instances;for(var n in t){var r=t[n];if(r.mode=="wysiwyg"&&!r.readOnly){var i=r.document.getBody();i.setAttribute("contentEditable",!1),i.setAttribute("contentEditable",!0)}}e.focusManager.hasFocus&&(e.toolbox.focus(),e.focus())}function s(e){if(!CKEDITOR.env.ie||CKEDITOR.env.version>6)return null;var t=CKEDITOR.dom.element.createFromHtml('<iframe frameborder="0" tabindex="-1" src="javascript:void((function(){document.open();'+(CKEDITOR.env.isCustomDomain()?"document.domain='"+this.getDocument().$.domain+"';":"")+"document.close();"+'})())"'+' style="display:block;position:absolute;z-index:-1;'+"progid:DXImageTransform.Microsoft.Alpha(opacity=0);"+'"></iframe>');return e.append(t,!0)}CKEDITOR.plugins.add("maximize",{init:function(e){function h(){var t=u.getViewPaneSize();c&&c.setStyles({width:t.width+"px",height:t.height+"px"}),e.resize(t.width,t.height,null,!0)}var t=e.lang,o=CKEDITOR.document,u=o.getWindow(),a,f,l,c,p=CKEDITOR.TRISTATE_OFF;e.addCommand("maximize",{modes:{wysiwyg:!CKEDITOR.env.iOS,source:!CKEDITOR.env.iOS},readOnly:1,editorFocus:!1,exec:function(){var d=e.container.getChild(1),v=e.getThemeSpace("contents");if(e.mode=="wysiwyg"){var m=e.getSelection();a=m&&m.getRanges(),f=u.getScrollPosition()}else{var g=e.textarea.$;a=!CKEDITOR.env.ie&&[g.selectionStart,g.selectionEnd],f=[g.scrollLeft,g.scrollTop]}if(this.state==CKEDITOR.TRISTATE_OFF){u.on("resize",h),l=u.getScrollPosition();var y=e.container;while(y=y.getParent())y.setCustomData("maximize_saved_styles",n(y)),y.setStyle("z-index",e.config.baseFloatZIndex-1);v.setCustomData("maximize_saved_styles",n(v,!0)),d.setCustomData("maximize_saved_styles",n(d,!0));var b={overflow:CKEDITOR.env.webkit?"":"hidden",width:0,height:0};o.getDocumentElement().setStyles(b),!CKEDITOR.env.gecko&&o.getDocumentElement().setStyle("position","fixed"),(!CKEDITOR.env.gecko||!CKEDITOR.env.quirks)&&o.getBody().setStyles(b),CKEDITOR.env.ie?setTimeout(function(){u.$.scrollTo(0,0)},0):u.$.scrollTo(0,0),d.setStyle("position",CKEDITOR.env.gecko&&CKEDITOR.env.quirks?"fixed":"absolute"),d.$.offsetLeft,d.setStyles({"z-index":e.config.baseFloatZIndex-1,left:"0px",top:"0px"}),c=s(d),d.addClass("cke_maximized"),h();var w=d.getDocumentPosition();d.setStyles({left:-1*w.x+"px",top:-1*w.y+"px"}),CKEDITOR.env.gecko&&i(e)}else if(this.state==CKEDITOR.TRISTATE_ON){u.removeListener("resize",h);var E=[v,d];for(var S=0;S<E.length;S++)r(E[S],E[S].getCustomData("maximize_saved_styles")),E[S].removeCustomData("maximize_saved_styles");y=e.container;while(y=y.getParent())r(y,y.getCustomData("maximize_saved_styles")),y.removeCustomData("maximize_saved_styles");CKEDITOR.env.ie?setTimeout(function(){u.$.scrollTo(l.x,l.y)},0):u.$.scrollTo(l.x,l.y),d.removeClass("cke_maximized"),CKEDITOR.env.webkit&&(d.setStyle("display","inline"),setTimeout(function(){d.setStyle("display","block")},0)),c&&(c.remove(),c=null),e.fire("resize")}this.toggleState();var x=this.uiItems[0];if(x){var T=this.state==CKEDITOR.TRISTATE_OFF?t.maximize:t.minimize,N=e.element.getDocument().getById(x._.id);N.getChild(1).setHtml(T),N.setAttribute("title",T),N.setAttribute("href",'javascript:void("'+T+'");')}if(e.mode=="wysiwyg")if(a){CKEDITOR.env.gecko&&i(e),e.getSelection().selectRanges(a);var C=e.getSelection().getStartElement();C&&C.scrollIntoView(!0)}else u.$.scrollTo(f.x,f.y);else a&&(g.selectionStart=a[0],g.selectionEnd=a[1]),g.scrollLeft=f[0],g.scrollTop=f[1];a=f=null,p=this.state},canUndo:!1}),e.ui.addButton("Maximize",{label:t.maximize,command:"maximize"}),e.on("mode",function(){var t=e.getCommand("maximize");t.setState(t.state==CKEDITOR.TRISTATE_DISABLED?CKEDITOR.TRISTATE_DISABLED:p)},null,null,100)}})})();