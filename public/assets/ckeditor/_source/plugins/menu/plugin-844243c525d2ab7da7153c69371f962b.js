/*
Copyright (c) 2003-2012, CKSource - Frederico Knabben. All rights reserved.
For licensing, see LICENSE.html or http://ckeditor.com/license
*/
CKEDITOR.plugins.add("menu",{beforeInit:function(e){var t=e.config.menu_groups.split(","),n=e._.menuGroups={},r=e._.menuItems={};for(var i=0;i<t.length;i++)n[t[i]]=i+1;e.addMenuGroup=function(e,t){n[e]=t||100},e.addMenuItem=function(e,t){n[t.group]&&(r[e]=new CKEDITOR.menuItem(this,e,t))},e.addMenuItems=function(e){for(var t in e)this.addMenuItem(t,e[t])},e.getMenuItem=function(e){return r[e]},e.removeMenuItem=function(e){delete r[e]}},requires:["floatpanel"]}),function(){function e(e){e.sort(function(e,t){return e.group<t.group?-1:e.group>t.group?1:e.order<t.order?-1:e.order>t.order?1:0})}CKEDITOR.menu=CKEDITOR.tools.createClass({$:function(e,t){t=this._.definition=t||{},this.id=CKEDITOR.tools.getNextId(),this.editor=e,this.items=[],this._.listeners=[],this._.level=t.level||1;var n=CKEDITOR.tools.extend({},t.panel,{css:e.skin.editor.css,level:this._.level-1,block:{}}),r=n.block.attributes=n.attributes||{};!r.role&&(r.role="menu"),this._.panelDefinition=n},_:{onShow:function(){var e=this.editor.getSelection();CKEDITOR.env.ie&&e&&e.lock();var t=e&&e.getStartElement(),n=this._.listeners,r=[];this.removeAll();for(var i=0;i<n.length;i++){var s=n[i](t,e);if(s)for(var o in s){var u=this.editor.getMenuItem(o);u&&(!u.command||this.editor.getCommand(u.command).state)&&(u.state=s[o],this.add(u))}}},onClick:function(e){this.hide(!1),e.onClick?e.onClick():e.command&&this.editor.execCommand(e.command)},onEscape:function(e){var t=this.parent;if(t){t._.panel.hideChild();var n=t._.panel._.panel._.currentBlock,r=n._.focusIndex;n._.markItem(r)}else e==27&&this.hide();return!1},onHide:function(){if(CKEDITOR.env.ie&&!this.parent){var e=this.editor.getSelection();e&&e.unlock(!0)}this.onHide&&this.onHide()},showSubMenu:function(e){var t=this._.subMenu,n=this.items[e],r=n.getItems&&n.getItems();if(!r){this._.panel.hideChild();return}var i=this._.panel.getBlock(this.id);i._.focusIndex=e,t?t.removeAll():(t=this._.subMenu=new CKEDITOR.menu(this.editor,CKEDITOR.tools.extend({},this._.definition,{level:this._.level+1},!0)),t.parent=this,t._.onClick=CKEDITOR.tools.bind(this._.onClick,this));for(var s in r){var o=this.editor.getMenuItem(s);o&&(o.state=r[s],t.add(o))}var u=this._.panel.getBlock(this.id).element.getDocument().getById(this.id+String(e));t.show(u,2)}},proto:{add:function(e){e.order||(e.order=this.items.length),this.items.push(e)},removeAll:function(){this.items=[]},show:function(t,n,r,i){if(!this.parent){this._.onShow();if(!this.items.length)return}n=n||(this.editor.lang.dir=="rtl"?2:1);var s=this.items,o=this.editor,u=this._.panel,a=this._.element;if(!u){u=this._.panel=new CKEDITOR.ui.floatPanel(this.editor,CKEDITOR.document.getBody(),this._.panelDefinition,this._.level),u.onEscape=CKEDITOR.tools.bind(function(e){if(this._.onEscape(e)===!1)return!1},this),u.onHide=CKEDITOR.tools.bind(function(){this._.onHide&&this._.onHide()},this);var f=u.addBlock(this.id,this._.panelDefinition.block);f.autoSize=!0;var l=f.keys;l[40]="next",l[9]="next",l[38]="prev",l[CKEDITOR.SHIFT+9]="prev",l[o.lang.dir=="rtl"?37:39]=CKEDITOR.env.ie?"mouseup":"click",l[32]=CKEDITOR.env.ie?"mouseup":"click",CKEDITOR.env.ie&&(l[13]="mouseup"),a=this._.element=f.element,a.addClass(o.skinClass);var c=a.getDocument();c.getBody().setStyle("overflow","hidden"),c.getElementsByTag("html").getItem(0).setStyle("overflow","hidden"),this._.itemOverFn=CKEDITOR.tools.addFunction(function(e){clearTimeout(this._.showSubTimeout),this._.showSubTimeout=CKEDITOR.tools.setTimeout(this._.showSubMenu,o.config.menu_subMenuDelay||400,this,[e])},this),this._.itemOutFn=CKEDITOR.tools.addFunction(function(e){clearTimeout(this._.showSubTimeout)},this),this._.itemClickFn=CKEDITOR.tools.addFunction(function(e){var t=this.items[e];if(t.state==CKEDITOR.TRISTATE_DISABLED){this.hide();return}t.getItems?this._.showSubMenu(e):this._.onClick(t)},this)}e(s);var h=o.container.getChild(1),p=h.hasClass("cke_mixed_dir_content")?" cke_mixed_dir_content":"",d=['<div class="cke_menu'+p+'" role="presentation">'],v=s.length,m=v&&s[0].group;for(var g=0;g<v;g++){var y=s[g];m!=y.group&&(d.push('<div class="cke_menuseparator" role="separator"></div>'),m=y.group),y.render(this,g,d)}d.push("</div>"),a.setHtml(d.join("")),CKEDITOR.ui.fire("ready",this),this.parent?this.parent._.panel.showAsChild(u,this.id,t,n,r,i):u.showBlock(this.id,t,n,r,i),o.fire("menuShow",[u])},addListener:function(e){this._.listeners.push(e)},hide:function(e){this._.onHide&&this._.onHide(),this._.panel&&this._.panel.hide(e)}}}),CKEDITOR.menuItem=CKEDITOR.tools.createClass({$:function(e,t,n){CKEDITOR.tools.extend(this,n,{order:0,className:"cke_button_"+t}),this.group=e._.menuGroups[this.group],this.editor=e,this.name=t},proto:{render:function(e,t,n){var r=e.id+String(t),i=typeof this.state=="undefined"?CKEDITOR.TRISTATE_OFF:this.state,s=" cke_"+(i==CKEDITOR.TRISTATE_ON?"on":i==CKEDITOR.TRISTATE_DISABLED?"disabled":"off"),o=this.label;this.className&&(s+=" "+this.className);var u=this.getItems;n.push('<span class="cke_menuitem'+(this.icon&&this.icon.indexOf(".png")==-1?" cke_noalphafix":"")+'">'+'<a id="',r,'" class="',s,'" href="javascript:void(\'',(this.label||"").replace("'",""),'\')" title="',this.label,'" tabindex="-1"_cke_focus=1 hidefocus="true" role="menuitem"'+(u?'aria-haspopup="true"':"")+(i==CKEDITOR.TRISTATE_DISABLED?'aria-disabled="true"':"")+(i==CKEDITOR.TRISTATE_ON?'aria-pressed="true"':"")),(CKEDITOR.env.opera||CKEDITOR.env.gecko&&CKEDITOR.env.mac)&&n.push(' onkeypress="return false;"'),CKEDITOR.env.gecko&&n.push(' onblur="this.style.cssText = this.style.cssText;"');var a=(this.iconOffset||0)*-16;n.push(' onmouseover="CKEDITOR.tools.callFunction(',e._.itemOverFn,",",t,');" onmouseout="CKEDITOR.tools.callFunction(',e._.itemOutFn,",",t,');" '+(CKEDITOR.env.ie?'onclick="return false;" onmouseup':"onclick")+'="CKEDITOR.tools.callFunction(',e._.itemClickFn,",",t,'); return false;"><span class="cke_icon_wrapper"><span class="cke_icon"'+(this.icon?' style="background-image:url('+CKEDITOR.getUrl(this.icon)+");background-position:0 "+a+'px;"':"")+"></span></span>"+'<span class="cke_label">'),u&&n.push('<span class="cke_menuarrow">',"<span>&#",this.editor.lang.dir=="rtl"?"9668":"9658",";</span>","</span>"),n.push(o,"</span></a></span>")}}})}(),CKEDITOR.config.menu_groups="clipboard,form,tablecell,tablecellproperties,tablerow,tablecolumn,table,anchor,link,image,flash,checkbox,radio,textfield,hiddenfield,imagebutton,button,select,textarea,div";