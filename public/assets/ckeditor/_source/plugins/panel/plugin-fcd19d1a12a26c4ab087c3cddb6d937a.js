/*
Copyright (c) 2003-2012, CKSource - Frederico Knabben. All rights reserved.
For licensing, see LICENSE.html or http://ckeditor.com/license
*/
CKEDITOR.plugins.add("panel",{beforeInit:function(e){e.ui.addHandler(CKEDITOR.UI_PANEL,CKEDITOR.ui.panel.handler)}}),CKEDITOR.UI_PANEL="panel",CKEDITOR.ui.panel=function(e,t){t&&CKEDITOR.tools.extend(this,t),CKEDITOR.tools.extend(this,{className:"",css:[]}),this.id=CKEDITOR.tools.getNextId(),this.document=e,this._={blocks:{}}},CKEDITOR.ui.panel.handler={create:function(e){return new CKEDITOR.ui.panel(e)}},CKEDITOR.ui.panel.prototype={renderHtml:function(e){var t=[];return this.render(e,t),t.join("")},render:function(e,t){var n=this.id;t.push('<div class="',e.skinClass,'" lang="',e.langCode,'" role="presentation" style="display:none;z-index:'+(e.config.baseFloatZIndex+1)+'">'+"<div"+" id=",n," dir=",e.lang.dir,' role="presentation" class="cke_panel cke_',e.lang.dir),this.className&&t.push(" ",this.className),t.push('">');if(this.forceIFrame||this.css.length)t.push('<iframe id="',n,'_frame" frameborder="0" role="application" src="javascript:void('),t.push(CKEDITOR.env.isCustomDomain()?"(function(){document.open();document.domain='"+document.domain+"';"+"document.close();"+"})()":"0"),t.push(')"></iframe>');return t.push("</div></div>"),n},getHolderElement:function(){var e=this._.holder;if(!e){if(this.forceIFrame||this.css.length){var t=this.document.getById(this.id+"_frame"),n=t.getParent(),r=n.getAttribute("dir"),i=n.getParent().getAttribute("class"),s=n.getParent().getAttribute("lang"),o=t.getFrameDocument();CKEDITOR.env.iOS&&n.setStyles({overflow:"scroll","-webkit-overflow-scrolling":"touch"});var u=CKEDITOR.tools.addFunction(CKEDITOR.tools.bind(function(e){this.isLoaded=!0,this.onLoad&&this.onLoad()},this)),a='<!DOCTYPE html><html dir="'+r+'" class="'+i+'_container" lang="'+s+'">'+"<head>"+"<style>."+i+"_container{visibility:hidden}</style>"+CKEDITOR.tools.buildStyleHtml(this.css)+"</head>"+'<body class="cke_'+r+" cke_panel_frame "+CKEDITOR.env.cssClass+'" style="margin:0;padding:0"'+' onload="( window.CKEDITOR || window.parent.CKEDITOR ).tools.callFunction('+u+');"></body>'+"</html>";o.write(a);var f=o.getWindow();f.$.CKEDITOR=CKEDITOR,o.on("key"+(CKEDITOR.env.opera?"press":"down"),function(e){var t=e.data.getKeystroke(),n=this.document.getById(this.id).getAttribute("dir");if(this._.onKeyDown&&this._.onKeyDown(t)===!1){e.data.preventDefault();return}(t==27||t==(n=="rtl"?39:37))&&this.onEscape&&this.onEscape(t)===!1&&e.data.preventDefault()},this),e=o.getBody(),e.unselectable(),CKEDITOR.env.air&&CKEDITOR.tools.callFunction(u)}else e=this.document.getById(this.id);this._.holder=e}return e},addBlock:function(e,t){return t=this._.blocks[e]=t instanceof CKEDITOR.ui.panel.block?t:new CKEDITOR.ui.panel.block(this.getHolderElement(),t),this._.currentBlock||this.showBlock(e),t},getBlock:function(e){return this._.blocks[e]},showBlock:function(e){var t=this._.blocks,n=t[e],r=this._.currentBlock,i=!this.forceIFrame||CKEDITOR.env.ie?this._.holder:this.document.getById(this.id+"_frame");return r&&(i.removeAttributes(r.attributes),r.hide()),this._.currentBlock=n,i.setAttributes(n.attributes),CKEDITOR.fire("ariaWidget",i),n._.focusIndex=-1,this._.onKeyDown=n.onKeyDown&&CKEDITOR.tools.bind(n.onKeyDown,n),n.show(),n},destroy:function(){this.element&&this.element.remove()}},CKEDITOR.ui.panel.block=CKEDITOR.tools.createClass({$:function(e,t){this.element=e.append(e.getDocument().createElement("div",{attributes:{tabIndex:-1,"class":"cke_panel_block",role:"presentation"},styles:{display:"none"}})),t&&CKEDITOR.tools.extend(this,t),this.attributes.title||(this.attributes.title=this.attributes["aria-label"]),this.keys={},this._.focusIndex=-1,this.element.disableContextMenu()},_:{markItem:function(e){if(e==-1)return;var t=this.element.getElementsByTag("a"),n=t.getItem(this._.focusIndex=e);(CKEDITOR.env.webkit||CKEDITOR.env.opera)&&n.getDocument().getWindow().focus(),n.focus(),this.onMark&&this.onMark(n)}},proto:{show:function(){this.element.setStyle("display","")},hide:function(){(!this.onHide||this.onHide.call(this)!==!0)&&this.element.setStyle("display","none")},onKeyDown:function(e){var t=this.keys[e];switch(t){case"next":var n=this._.focusIndex,r=this.element.getElementsByTag("a"),i;while(i=r.getItem(++n))if(i.getAttribute("_cke_focus")&&i.$.offsetWidth){this._.focusIndex=n,i.focus();break}return!1;case"prev":n=this._.focusIndex,r=this.element.getElementsByTag("a");while(n>0&&(i=r.getItem(--n)))if(i.getAttribute("_cke_focus")&&i.$.offsetWidth){this._.focusIndex=n,i.focus();break}return!1;case"click":case"mouseup":return n=this._.focusIndex,i=n>=0&&this.element.getElementsByTag("a").getItem(n),i&&(i.$[t]?i.$[t]():i.$["on"+t]()),!1}return!0}}});