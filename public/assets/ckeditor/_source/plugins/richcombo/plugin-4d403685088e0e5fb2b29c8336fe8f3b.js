/*
Copyright (c) 2003-2012, CKSource - Frederico Knabben. All rights reserved.
For licensing, see LICENSE.html or http://ckeditor.com/license
*/
CKEDITOR.plugins.add("richcombo",{requires:["floatpanel","listblock","button"],beforeInit:function(e){e.ui.addHandler(CKEDITOR.UI_RICHCOMBO,CKEDITOR.ui.richCombo.handler)}}),CKEDITOR.UI_RICHCOMBO="richcombo",CKEDITOR.ui.richCombo=CKEDITOR.tools.createClass({$:function(e){CKEDITOR.tools.extend(this,e,{title:e.label,modes:{wysiwyg:1}});var t=this.panel||{};delete this.panel,this.id=CKEDITOR.tools.getNextNumber(),this.document=t&&t.parent&&t.parent.getDocument()||CKEDITOR.document,t.className=(t.className||"")+" cke_rcombopanel",t.block={multiSelect:t.multiSelect,attributes:t.attributes},this._={panelDefinition:t,items:{},state:CKEDITOR.TRISTATE_OFF}},statics:{handler:{create:function(e){return new CKEDITOR.ui.richCombo(e)}}},proto:{renderHtml:function(e){var t=[];return this.render(e,t),t.join("")},render:function(e,t){function o(){var t=this.modes[e.mode]?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED;this.setState(e.readOnly&&!this.readOnly?CKEDITOR.TRISTATE_DISABLED:t),this.setValue("")}var n=CKEDITOR.env,r="cke_"+this.id,i=CKEDITOR.tools.addFunction(function(t){var n=this._;if(n.state==CKEDITOR.TRISTATE_DISABLED)return;this.createPanel(e);if(n.on){n.panel.hide();return}this.commit();var r=this.getValue();r?n.list.mark(r):n.list.unmarkAll(),n.panel.showBlock(this.id,new CKEDITOR.dom.element(t),4)},this),s={id:r,combo:this,focus:function(){var e=CKEDITOR.document.getById(r).getChild(1);e.focus()},clickFn:i};e.on("mode",o,this),!this.readOnly&&e.on("readOnly",o,this);var u=CKEDITOR.tools.addFunction(function(e,t){e=new CKEDITOR.dom.event(e);var n=e.getKeystroke();switch(n){case 13:case 32:case 40:CKEDITOR.tools.callFunction(i,t);break;default:s.onkey(s,n)}e.preventDefault()}),a=CKEDITOR.tools.addFunction(function(){s.onfocus&&s.onfocus()});return s.keyDownFn=u,t.push('<span class="cke_rcombo" role="presentation">',"<span id=",r),this.className&&t.push(' class="',this.className,' cke_off"'),t.push(' role="presentation">','<span id="'+r+'_label" class=cke_label>',this.label,"</span>",'<a hidefocus=true title="',this.title,'" tabindex="-1"',n.gecko&&n.version>=10900&&!n.hc?"":" href=\"javascript:void('"+this.label+"')\"",' role="button" aria-labelledby="',r,'_label" aria-describedby="',r,'_text" aria-haspopup="true"'),(CKEDITOR.env.opera||CKEDITOR.env.gecko&&CKEDITOR.env.mac)&&t.push(' onkeypress="return false;"'),CKEDITOR.env.gecko&&t.push(' onblur="this.style.cssText = this.style.cssText;"'),t.push(' onkeydown="CKEDITOR.tools.callFunction( ',u,', event, this );" onfocus="return CKEDITOR.tools.callFunction(',a,', event);" '+(CKEDITOR.env.ie?'onclick="return false;" onmouseup':"onclick")+'="CKEDITOR.tools.callFunction(',i,', this); return false;"><span><span id="'+r+'_text" class="cke_text cke_inline_label">'+this.label+"</span>"+"</span>"+"<span class=cke_openbutton><span class=cke_icon>"+(CKEDITOR.env.hc?"&#9660;":CKEDITOR.env.air?"&nbsp;":"")+"</span></span>"+"</a>"+"</span>"+"</span>"),this.onRender&&this.onRender(),s},createPanel:function(e){if(this._.panel)return;var t=this._.panelDefinition,n=this._.panelDefinition.block,r=t.parent||CKEDITOR.document.getBody(),i=new CKEDITOR.ui.floatPanel(e,r,t),s=i.addListBlock(this.id,n),o=this;i.onShow=function(){o.className&&this.element.getFirst().addClass(o.className+"_panel"),o.setState(CKEDITOR.TRISTATE_ON),s.focus(!o.multiSelect&&o.getValue()),o._.on=1,o.onOpen&&o.onOpen()},i.onHide=function(t){o.className&&this.element.getFirst().removeClass(o.className+"_panel"),o.setState(o.modes&&o.modes[e.mode]?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED),o._.on=0,!t&&o.onClose&&o.onClose()},i.onEscape=function(){i.hide()},s.onClick=function(e,t){o.document.getWindow().focus(),o.onClick&&o.onClick.call(o,e,t),t?o.setValue(e,o._.items[e]):o.setValue(""),i.hide(!1)},this._.panel=i,this._.list=s,i.getBlock(this.id).onHide=function(){o._.on=0,o.setState(CKEDITOR.TRISTATE_OFF)},this.init&&this.init()},setValue:function(e,t){this._.value=e;var n=this.document.getById("cke_"+this.id+"_text");n&&(!e&&!t?(t=this.label,n.addClass("cke_inline_label")):n.removeClass("cke_inline_label"),n.setHtml(typeof t!="undefined"?t:e))},getValue:function(){return this._.value||""},unmarkAll:function(){this._.list.unmarkAll()},mark:function(e){this._.list.mark(e)},hideItem:function(e){this._.list.hideItem(e)},hideGroup:function(e){this._.list.hideGroup(e)},showAll:function(){this._.list.showAll()},add:function(e,t,n){this._.items[e]=n||e,this._.list.add(e,t,n)},startGroup:function(e){this._.list.startGroup(e)},commit:function(){this._.committed||(this._.list.commit(),this._.committed=1,CKEDITOR.ui.fire("ready",this)),this._.committed=1},setState:function(e){if(this._.state==e)return;this.document.getById("cke_"+this.id).setState(e),this._.state=e}}}),CKEDITOR.ui.prototype.addRichCombo=function(e,t){this.add(e,CKEDITOR.UI_RICHCOMBO,t)};