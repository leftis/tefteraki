/*
Copyright (c) 2003-2012, CKSource - Frederico Knabben. All rights reserved.
For licensing, see LICENSE.html or http://ckeditor.com/license
*/
/**
 * @fileOverview The "sourcearea" plugin. It registers the "source" editing
 *		mode, which displays the raw data being edited in the editor.
 */
CKEDITOR.plugins.add("sourcearea",{requires:["editingblock"],init:function(e){var t=CKEDITOR.plugins.sourcearea,n=CKEDITOR.document.getWindow();e.on("editingBlockReady",function(){var t,r;e.addMode("source",{load:function(i,s){CKEDITOR.env.ie&&CKEDITOR.env.version<8&&i.setStyle("position","relative"),e.textarea=t=new CKEDITOR.dom.element("textarea"),t.setAttributes({dir:"ltr",tabIndex:CKEDITOR.env.webkit?-1:e.tabIndex,role:"textbox","aria-label":e.lang.editorTitle.replace("%1",e.name)}),t.addClass("cke_source"),t.addClass("cke_enable_context_menu"),e.readOnly&&t.setAttribute("readOnly","readonly");var o={width:CKEDITOR.env.ie7Compat?"99%":"100%",height:"100%",resize:"none",outline:"none","text-align":"left"};CKEDITOR.env.ie&&(r=function(){t.hide(),t.setStyle("height",i.$.clientHeight+"px"),t.setStyle("width",i.$.clientWidth+"px"),t.show()},e.on("resize",r),n.on("resize",r),setTimeout(r,0)),i.setHtml(""),i.append(t),t.setStyles(o),e.fire("ariaWidget",t),t.on("blur",function(){e.focusManager.blur()}),t.on("focus",function(){e.focusManager.focus()}),e.mayBeDirty=!0,this.loadData(s);var u=e.keystrokeHandler;u&&u.attach(t),setTimeout(function(){e.mode="source",e.fire("mode",{previousMode:e._.previousMode})},CKEDITOR.env.gecko||CKEDITOR.env.webkit?100:0)},loadData:function(n){t.setValue(n),e.fire("dataReady")},getData:function(){return t.getValue()},getSnapshotData:function(){return t.getValue()},unload:function(i){t.clearCustomData(),e.textarea=t=null,r&&(e.removeListener("resize",r),n.removeListener("resize",r)),CKEDITOR.env.ie&&CKEDITOR.env.version<8&&i.removeStyle("position")},focus:function(){t.focus()}})}),e.on("readOnly",function(){e.mode=="source"&&(e.readOnly?e.textarea.setAttribute("readOnly","readonly"):e.textarea.removeAttribute("readOnly"))}),e.addCommand("source",t.commands.source),e.ui.addButton&&e.ui.addButton("Source",{label:e.lang.source,command:"source"}),e.on("mode",function(){e.getCommand("source").setState(e.mode=="source"?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF)})}}),CKEDITOR.plugins.sourcearea={commands:{source:{modes:{wysiwyg:1,source:1},editorFocus:!1,readOnly:1,exec:function(e){e.mode=="wysiwyg"&&e.fire("saveSnapshot"),e.getCommand("source").setState(CKEDITOR.TRISTATE_DISABLED),e.setMode(e.mode=="source"?"wysiwyg":"source")},canUndo:!1}}};