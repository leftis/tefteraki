/*
Copyright (c) 2003-2012, CKSource - Frederico Knabben. All rights reserved.
For licensing, see LICENSE.html or http://ckeditor.com/license
*/
CKEDITOR.plugins.add("styles",{requires:["selection"],init:function(e){e.on("contentDom",function(){e.document.setCustomData("cke_includeReadonly",!e.config.disableReadonlyStyling)})}}),CKEDITOR.editor.prototype.attachStyleStateChange=function(e,t){var n=this._.styleStateChangeCallbacks;n||(n=this._.styleStateChangeCallbacks=[],this.on("selectionChange",function(e){for(var t=0;t<n.length;t++){var r=n[t],i=r.style.checkActive(e.data.path)?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF;r.fn.call(this,i)}})),n.push({style:e,fn:t})},CKEDITOR.STYLE_BLOCK=1,CKEDITOR.STYLE_INLINE=2,CKEDITOR.STYLE_OBJECT=3,function(){function o(e){var t,n;while(e=e.getParent()){if(e.getName()=="body")break;if(e.getAttribute("data-nostyle"))t=e;else if(!n){var r=e.getAttribute("contentEditable");r=="false"?t=e:r=="true"&&(n=1)}}return t}function u(e){var t=e.document;if(e.collapsed){var n=x(this,t);e.insertNode(n),e.moveToPosition(n,CKEDITOR.POSITION_BEFORE_END);return}var r=this.element,s=this._.definition,u,a=s.ignoreReadonly,f=a||s.includeReadonly;f==undefined&&(f=t.getCustomData("cke_includeReadonly"));var l=CKEDITOR.dtd[r]||(u=!0,CKEDITOR.dtd.span);e.enlarge(CKEDITOR.ENLARGE_ELEMENT,1),e.trim();var c=e.createBookmark(),h=c.startNode,p=c.endNode,d=h,v;if(!a){var m=o(h),g=o(p);m&&(d=m.getNextSourceNode(!0)),g&&(p=g)}d.getPosition(p)==CKEDITOR.POSITION_FOLLOWING&&(d=0);while(d){var y=!1;if(d.equals(p))d=null,y=!0;else{var b=d.type,E=b==CKEDITOR.NODE_ELEMENT?d.getName():null,S=E&&d.getAttribute("contentEditable")=="false",T=E&&d.getAttribute("data-nostyle");if(E&&d.data("cke-bookmark")){d=d.getNextSourceNode(!0);continue}if(!E||l[E]&&!T&&(!S||f)&&(d.getPosition(p)|CKEDITOR.POSITION_PRECEDING|CKEDITOR.POSITION_IDENTICAL|CKEDITOR.POSITION_IS_CONTAINED)==CKEDITOR.POSITION_PRECEDING+CKEDITOR.POSITION_IDENTICAL+CKEDITOR.POSITION_IS_CONTAINED&&(!s.childRule||s.childRule(d))){var N=d.getParent();if(N&&((N.getDtd()||CKEDITOR.dtd.span)[r]||u)&&(!s.parentRule||s.parentRule(N))){!v&&(!E||!CKEDITOR.dtd.$removeEmpty[E]||(d.getPosition(p)|CKEDITOR.POSITION_PRECEDING|CKEDITOR.POSITION_IDENTICAL|CKEDITOR.POSITION_IS_CONTAINED)==CKEDITOR.POSITION_PRECEDING+CKEDITOR.POSITION_IDENTICAL+CKEDITOR.POSITION_IS_CONTAINED)&&(v=new CKEDITOR.dom.range(t),v.setStartBefore(d));if(b==CKEDITOR.NODE_TEXT||S||b==CKEDITOR.NODE_ELEMENT&&!d.getChildCount()){var C=d,k;while((y=!C.getNext(i))&&(k=C.getParent(),l[k.getName()])&&(k.getPosition(h)|CKEDITOR.POSITION_FOLLOWING|CKEDITOR.POSITION_IDENTICAL|CKEDITOR.POSITION_IS_CONTAINED)==CKEDITOR.POSITION_FOLLOWING+CKEDITOR.POSITION_IDENTICAL+CKEDITOR.POSITION_IS_CONTAINED&&(!s.childRule||s.childRule(k)))C=k;v.setEndAfter(C)}}else y=!0}else y=!0;d=d.getNextSourceNode(T||S)}if(y&&v&&!v.collapsed){var L=x(this,t),A=L.hasAttributes(),O=v.getCommonAncestor(),M={styles:{},attrs:{},blockedStyles:{},blockedAttrs:{}},_,D,P;while(L&&O){if(O.getName()==r){for(_ in s.attributes){if(M.blockedAttrs[_]||!(P=O.getAttribute(D)))continue;L.getAttribute(_)==P?M.attrs[_]=1:M.blockedAttrs[_]=1}for(D in s.styles){if(M.blockedStyles[D]||!(P=O.getStyle(D)))continue;L.getStyle(D)==P?M.styles[D]=1:M.blockedStyles[D]=1}}O=O.getParent()}for(_ in M.attrs)L.removeAttribute(_);for(D in M.styles)L.removeStyle(D);A&&!L.hasAttributes()&&(L=null),L?(v.extractContents().appendTo(L),w(this,L),v.insertNode(L),L.mergeSiblings(),CKEDITOR.env.ie||L.$.normalize()):(L=new CKEDITOR.dom.element("span"),v.extractContents().appendTo(L),v.insertNode(L),w(this,L),L.remove(!0)),v=null}}e.moveToBookmark(c),e.shrink(CKEDITOR.SHRINK_TEXT)}function a(e){e.enlarge(CKEDITOR.ENLARGE_ELEMENT,1);var t=e.createBookmark(),n=t.startNode;if(e.collapsed){var r=new CKEDITOR.dom.elementPath(n.getParent()),i;for(var s=0,o;s<r.elements.length&&(o=r.elements[s]);s++){if(o==r.block||o==r.blockLimit)break;if(this.checkElementRemovable(o)){var u;e.collapsed&&(e.checkBoundaryOfElement(o,CKEDITOR.END)||(u=e.checkBoundaryOfElement(o,CKEDITOR.START)))?(i=o,i.match=u?"start":"end"):(o.mergeSiblings(),o.getName()==this.element?b(this,o):E(o,k(this)[o.getName()]))}}if(i){var a=n;for(s=0;;s++){var f=r.elements[s];if(f.equals(i))break;if(f.match)continue;f=f.clone(),f.append(a),a=f}a[i.match=="start"?"insertBefore":"insertAfter"](i)}}else{var l=t.endNode,c=this;function h(){var e=new CKEDITOR.dom.elementPath(n.getParent()),t=new CKEDITOR.dom.elementPath(l.getParent()),r=null,i=null;for(var s=0;s<e.elements.length;s++){var o=e.elements[s];if(o==e.block||o==e.blockLimit)break;c.checkElementRemovable(o)&&(r=o)}for(s=0;s<t.elements.length;s++){o=t.elements[s];if(o==t.block||o==t.blockLimit)break;c.checkElementRemovable(o)&&(i=o)}i&&l.breakParent(i),r&&n.breakParent(r)}h();var p=n;while(!p.equals(l)){var d=p.getNextSourceNode();p.type==CKEDITOR.NODE_ELEMENT&&this.checkElementRemovable(p)&&(p.getName()==this.element?b(this,p):E(p,k(this)[p.getName()]),d.type==CKEDITOR.NODE_ELEMENT&&d.contains(n)&&(h(),d=n.getNext())),p=d}}e.moveToBookmark(t)}function f(e){var t=e.getCommonAncestor(!0,!0),n=t.getAscendant(this.element,!0);n&&!n.isReadOnly()&&T(n,this)}function l(e){var t=e.getCommonAncestor(!0,!0),n=t.getAscendant(this.element,!0);if(!n)return;var r=this,i=r._.definition,s=i.attributes;if(s)for(var o in s)n.removeAttribute(o,s[o]);if(i.styles)for(var u in i.styles){if(!i.styles.hasOwnProperty(u))continue;n.removeStyle(u)}}function c(e){var t=e.createBookmark(!0),n=e.createIterator();n.enforceRealBlocks=!0,this._.enterMode&&(n.enlargeBr=this._.enterMode!=CKEDITOR.ENTER_BR);var r,i=e.document,s;while(r=n.getNextParagraph())if(!r.isReadOnly()){var o=x(this,i,r);p(r,o)}e.moveToBookmark(t)}function h(e){var t=e.createBookmark(1),n=e.createIterator();n.enforceRealBlocks=!0,n.enlargeBr=this._.enterMode!=CKEDITOR.ENTER_BR;var r;while(r=n.getNextParagraph())if(this.checkElementRemovable(r))if(r.is("pre")){var i=this._.enterMode==CKEDITOR.ENTER_BR?null:e.document.createElement(this._.enterMode==CKEDITOR.ENTER_P?"p":"div");i&&r.copyAttributes(i),p(r,i)}else b(this,r,1);e.moveToBookmark(t)}function p(e,t){var n=!t;n&&(t=e.getDocument().createElement("div"),e.copyAttributes(t));var r=t&&t.is("pre"),i=e.is("pre"),s=r&&!i,o=!r&&i;s?t=y(e,t):o?t=g(n?[e.getHtml()]:v(e),t):e.moveChildren(t),t.replace(e),r?d(t):n&&S(t)}function d(e){var t;if(!((t=e.getPrevious(s))&&t.is&&t.is("pre")))return;var n=m(t.getHtml(),/\n$/,"")+"\n\n"+m(e.getHtml(),/^\n/,"");CKEDITOR.env.ie?e.$.outerHTML="<pre>"+n+"</pre>":e.setHtml(n),t.remove()}function v(e){var t=/(\S\s*)\n(?:\s|(<span[^>]+data-cke-bookmark.*?\/span>))*\n(?!$)/gi,n=e.getName(),r=m(e.getOuterHtml(),t,function(e,t,n){return t+"</pre>"+n+"<pre>"}),i=[];return r.replace(/<pre\b.*?>([\s\S]*?)<\/pre>/gi,function(e,t){i.push(t)}),i}function m(e,t,n){var r="",i="";return e=e.replace(/(^<span[^>]+data-cke-bookmark.*?\/span>)|(<span[^>]+data-cke-bookmark.*?\/span>$)/gi,function(e,t,n){return t&&(r=t),n&&(i=n),""}),r+e.replace(t,n)+i}function g(e,t){var n;e.length>1&&(n=new CKEDITOR.dom.documentFragment(t.getDocument()));for(var r=0;r<e.length;r++){var i=e[r];i=i.replace(/(\r\n|\r)/g,"\n"),i=m(i,/^[ \t]*\n/,""),i=m(i,/\n$/,""),i=m(i,/^[ \t]+|[ \t]+$/g,function(e,t,n){return e.length==1?"&nbsp;":t?" "+CKEDITOR.tools.repeat("&nbsp;",e.length-1):CKEDITOR.tools.repeat("&nbsp;",e.length-1)+" "}),i=i.replace(/\n/g,"<br>"),i=i.replace(/[ \t]{2,}/g,function(e){return CKEDITOR.tools.repeat("&nbsp;",e.length-1)+" "});if(n){var s=t.clone();s.setHtml(i),n.append(s)}else t.setHtml(i)}return n||t}function y(e,t){var n=e.getBogus();n&&n.remove();var r=e.getHtml();r=m(r,/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g,""),r=r.replace(/[ \t\r\n]*(<br[^>]*>)[ \t\r\n]*/gi,"$1"),r=r.replace(/([ \t\n\r]+|&nbsp;)/g," "),r=r.replace(/<br\b[^>]*>/gi,"\n");if(CKEDITOR.env.ie){var i=e.getDocument().createElement("div");i.append(t),t.$.outerHTML="<pre>"+r+"</pre>",t.copyAttributes(i.getFirst()),t=i.getFirst().remove()}else t.setHtml(r);return t}function b(t,n){var r=t._.definition,i=r.attributes,s=r.styles,o=k(t)[n.getName()],u=CKEDITOR.tools.isEmpty(i)&&CKEDITOR.tools.isEmpty(s);for(var a in i){if(!(a!="class"&&!t._.definition.fullMatch||n.getAttribute(a)==L(a,i[a])))continue;u=n.hasAttribute(a),n.removeAttribute(a)}for(var f in s){if(t._.definition.fullMatch&&n.getStyle(f)!=L(f,s[f],true))continue;u=u||!!n.getStyle(f),n.removeStyle(f)}E(n,o,e[n.getName()]),u&&(!CKEDITOR.dtd.$block[n.getName()]||t._.enterMode==CKEDITOR.ENTER_BR&&!n.hasAttributes()?S(n):n.renameNode(t._.enterMode==CKEDITOR.ENTER_P?"p":"div"))}function w(e,t){var n=e._.definition,r=n.attributes,i=n.styles,s=k(e),o=t.getElementsByTag(e.element);for(var u=o.count();--u>=0;)b(e,o.getItem(u));for(var a in s)if(a!=e.element){o=t.getElementsByTag(a);for(u=o.count()-1;u>=0;u--){var f=o.getItem(u);E(f,s[a])}}}function E(e,t,n){var r=t&&t.attributes;if(r)for(var i=0;i<r.length;i++){var s=r[i][0],o;if(o=e.getAttribute(s)){var u=r[i][1];(u===null||u.test&&u.test(o)||typeof u=="string"&&o==u)&&e.removeAttribute(s)}}n||S(e)}function S(e){if(!e.hasAttributes())if(CKEDITOR.dtd.$block[e.getName()]){var t=e.getPrevious(s),n=e.getNext(s);t&&(t.type==CKEDITOR.NODE_TEXT||!t.isBlockBoundary({br:1}))&&e.append("br",1),n&&(n.type==CKEDITOR.NODE_TEXT||!n.isBlockBoundary({br:1}))&&e.append("br"),e.remove(!0)}else{var r=e.getFirst(),i=e.getLast();e.remove(!0),r&&(r.type==CKEDITOR.NODE_ELEMENT&&r.mergeSiblings(),i&&!r.equals(i)&&i.type==CKEDITOR.NODE_ELEMENT&&i.mergeSiblings())}}function x(e,t,n){var r,i=e._.definition,s=e.element;return s=="*"&&(s="span"),r=new CKEDITOR.dom.element(s,t),n&&n.copyAttributes(r),r=T(r,e),t.getCustomData("doc_processing_style")&&r.hasAttribute("id")?r.removeAttribute("id"):t.setCustomData("doc_processing_style",1),r}function T(e,t){var n=t._.definition,r=n.attributes,i=CKEDITOR.style.getStyleText(n);if(r)for(var s in r)e.setAttribute(s,r[s]);return i&&e.setAttribute("style",i),e}function N(e,t){for(var n in e)e[n]=e[n].replace(r,function(e,n){return t[n]})}function C(e){var t=e._AC;if(t)return t;t={};var n=0,r=e.attributes;if(r)for(var i in r)n++,t[i]=r[i];var s=CKEDITOR.style.getStyleText(e);return s&&(t.style||n++,t.style=s),t._length=n,e._AC=t}function k(e){if(e._.overrides)return e._.overrides;var t=e._.overrides={},n=e._.definition.overrides;if(n){CKEDITOR.tools.isArray(n)||(n=[n]);for(var r=0;r<n.length;r++){var i=n[r],s,o,u;typeof i=="string"?s=i.toLowerCase():(s=i.element?i.element.toLowerCase():e.element,u=i.attributes),o=t[s]||(t[s]={});if(u){var a=o.attributes=o.attributes||new Array;for(var f in u)a.push([f.toLowerCase(),u[f]])}}}return t}function L(e,t,n){var r=new CKEDITOR.dom.element("span");return r[n?"setStyle":"setAttribute"](e,t),r[n?"getStyle":"getAttribute"](e)}function A(e,t){var n;if(t!==!1){var r=new CKEDITOR.dom.element("span");r.setAttribute("style",e),n=r.getAttribute("style")||""}else n=e;return n=n.replace(/(font-family:)(.*?)(?=;|$)/,function(e,t,n){var r=n.split(",");for(var i=0;i<r.length;i++)r[i]=CKEDITOR.tools.trim(r[i].replace(/["']/g,""));return t+r.join(",")}),n.replace(/\s*([;:])\s*/,"$1").replace(/([^\s;])$/,"$1;").replace(/,\s+/g,",").replace(/\"/g,"").toLowerCase()}function O(e){var t={};return e.replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(e,n,r){t[n]=r}),t}function M(e,t){typeof e=="string"&&(e=O(e)),typeof t=="string"&&(t=O(t));for(var n in e)if(!(n in t)||t[n]!=e[n]&&e[n]!="inherit"&&t[n]!="inherit")return!1;return!0}function _(e,t){var n=e.getSelection(),r=n.createBookmarks(1),i=n.getRanges(),s=t?this.removeFromRange:this.applyToRange,o,u=i.createIterator();while(o=u.getNextRange())s.call(this,o);r.length==1&&r[0].collapsed?(n.selectRanges(i),e.getById(r[0].startNode).remove()):n.selectBookmarks(r),e.removeCustomData("doc_processing_style")}var e={address:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1,section:1,header:1,footer:1,nav:1,article:1,aside:1,figure:1,dialog:1,hgroup:1,time:1,meter:1,menu:1,command:1,keygen:1,output:1,progress:1,details:1,datagrid:1,datalist:1},t={a:1,embed:1,hr:1,img:1,li:1,object:1,ol:1,table:1,td:1,tr:1,th:1,ul:1,dl:1,dt:1,dd:1,form:1,audio:1,video:1},n=/\s*(?:;\s*|$)/,r=/#\((.+?)\)/g,i=CKEDITOR.dom.walker.bookmark(0,1),s=CKEDITOR.dom.walker.whitespaces(1);CKEDITOR.style=function(n,r){var i=n.attributes;i&&i.style&&(n.styles=CKEDITOR.tools.extend({},n.styles,O(i.style)),delete i.style),r&&(n=CKEDITOR.tools.clone(n),N(n.attributes,r),N(n.styles,r));var s=this.element=n.element?typeof n.element=="string"?n.element.toLowerCase():n.element:"*";this.type=e[s]?CKEDITOR.STYLE_BLOCK:t[s]?CKEDITOR.STYLE_OBJECT:CKEDITOR.STYLE_INLINE,typeof this.element=="object"&&(this.type=CKEDITOR.STYLE_OBJECT),this._={definition:n}},CKEDITOR.style.prototype={apply:function(e){_.call(this,e,!1)},remove:function(e){_.call(this,e,!0)},applyToRange:function(e){return(this.applyToRange=this.type==CKEDITOR.STYLE_INLINE?u:this.type==CKEDITOR.STYLE_BLOCK?c:this.type==CKEDITOR.STYLE_OBJECT?f:null).call(this,e)},removeFromRange:function(e){return(this.removeFromRange=this.type==CKEDITOR.STYLE_INLINE?a:this.type==CKEDITOR.STYLE_BLOCK?h:this.type==CKEDITOR.STYLE_OBJECT?l:null).call(this,e)},applyToObject:function(e){T(e,this)},checkActive:function(e){switch(this.type){case CKEDITOR.STYLE_BLOCK:return this.checkElementRemovable(e.block||e.blockLimit,!0);case CKEDITOR.STYLE_OBJECT:case CKEDITOR.STYLE_INLINE:var t=e.elements;for(var n=0,r;n<t.length;n++){r=t[n];if(this.type==CKEDITOR.STYLE_INLINE&&(r==e.block||r==e.blockLimit))continue;if(this.type==CKEDITOR.STYLE_OBJECT){var i=r.getName();if(!(typeof this.element=="string"?i==this.element:i in this.element))continue}if(this.checkElementRemovable(r,!0))return!0}}return!1},checkApplicable:function(e){switch(this.type){case CKEDITOR.STYLE_INLINE:case CKEDITOR.STYLE_BLOCK:break;case CKEDITOR.STYLE_OBJECT:return e.lastElement.getAscendant(this.element,!0)}return!0},checkElementMatch:function(e,t){var n=this._.definition;if(!e||!n.ignoreReadonly&&e.isReadOnly())return!1;var r,i=e.getName();if(typeof this.element=="string"?i==this.element:i in this.element){if(!t&&!e.hasAttributes())return!0;r=C(n);if(!r._length)return!0;for(var s in r){if(s=="_length")continue;var o=e.getAttribute(s)||"";if(s=="style"?M(r[s],A(o,!1)):r[s]==o){if(!t)return!0}else if(t)return!1}if(t)return!0}return!1},checkElementRemovable:function(e,t){if(this.checkElementMatch(e,t))return!0;var n=k(this)[e.getName()];if(n){var r,i;if(!(r=n.attributes))return!0;for(var s=0;s<r.length;s++){i=r[s][0];var o=e.getAttribute(i);if(o){var u=r[s][1];if(u===null||typeof u=="string"&&o==u||u.test(o))return!0}}}return!1},buildPreview:function(e){var t=this._.definition,n=[],r=t.element;r=="bdo"&&(r="span"),n=["<",r];var i=t.attributes;if(i)for(var s in i)n.push(" ",s,'="',i[s],'"');var o=CKEDITOR.style.getStyleText(t);return o&&n.push(' style="',o,'"'),n.push(">",e||t.name,"</",r,">"),n.join("")}},CKEDITOR.style.getStyleText=function(e){var t=e._ST;if(t)return t;t=e.styles;var r=e.attributes&&e.attributes.style||"",i="";r.length&&(r=r.replace(n,";"));for(var s in t){var o=t[s],u=(s+":"+o).replace(n,";");o=="inherit"?i+=u:r+=u}return r.length&&(r=A(r)),r+=i,e._ST=r}}(),CKEDITOR.styleCommand=function(e){this.style=e},CKEDITOR.styleCommand.prototype.exec=function(e){e.focus();var t=e.document;return t&&(this.state==CKEDITOR.TRISTATE_OFF?this.style.apply(t):this.state==CKEDITOR.TRISTATE_ON&&this.style.remove(t)),!!t},CKEDITOR.stylesSet=new CKEDITOR.resourceManager("","stylesSet"),CKEDITOR.addStylesSet=CKEDITOR.tools.bind(CKEDITOR.stylesSet.add,CKEDITOR.stylesSet),CKEDITOR.loadStylesSet=function(e,t,n){CKEDITOR.stylesSet.addExternal(e,t,""),CKEDITOR.stylesSet.load(e,n)},CKEDITOR.editor.prototype.getStylesSet=function(e){if(!this._.stylesDefinitions){var t=this,n=t.config.stylesCombo_stylesSet||t.config.stylesSet||"default";if(n instanceof Array){t._.stylesDefinitions=n,e(n);return}var r=n.split(":"),i=r[0],s=r[1],o=CKEDITOR.plugins.registered.styles.path;CKEDITOR.stylesSet.addExternal(i,s?r.slice(1).join(":"):o+"styles/"+i+".js",""),CKEDITOR.stylesSet.load(i,function(n){t._.stylesDefinitions=n[i],e(t._.stylesDefinitions)})}else e(this._.stylesDefinitions)};