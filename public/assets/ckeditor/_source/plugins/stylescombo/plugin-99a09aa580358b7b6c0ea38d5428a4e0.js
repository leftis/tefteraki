/*
Copyright (c) 2003-2012, CKSource - Frederico Knabben. All rights reserved.
For licensing, see LICENSE.html or http://ckeditor.com/license
*/
(function(){function e(e,t){var n=e.type,r=t.type;return n==r?0:n==CKEDITOR.STYLE_OBJECT?-1:r==CKEDITOR.STYLE_OBJECT?1:r==CKEDITOR.STYLE_BLOCK?1:-1}CKEDITOR.plugins.add("stylescombo",{requires:["richcombo","styles"],init:function(t){function u(r){t.getStylesSet(function(t){if(!s.length){var o,u;for(var a=0,f=t.length;a<f;a++){var l=t[a];u=l.name,o=i[u]=new CKEDITOR.style(l),o._name=u,o._.enterMode=n.enterMode,s.push(o)}s.sort(e)}r&&r()})}var n=t.config,r=t.lang.stylesCombo,i={},s=[],o;t.ui.addRichCombo("Styles",{label:r.label,title:r.panelTitle,className:"cke_styles",panel:{css:t.skin.editor.css.concat(n.contentsCss),multiSelect:!0,attributes:{"aria-label":r.panelTitle}},init:function(){o=this,u(function(){var e,t,n,i,u,a;for(u=0,a=s.length;u<a;u++)e=s[u],t=e._name,i=e.type,i!=n&&(o.startGroup(r["panelTitle"+String(i)]),n=i),o.add(t,e.type==CKEDITOR.STYLE_OBJECT?t:e.buildPreview(),t);o.commit()})},onClick:function(e){t.focus(),t.fire("saveSnapshot");var n=i[e],r=t.getSelection(),s=new CKEDITOR.dom.elementPath(r.getStartElement());n[n.checkActive(s)?"remove":"apply"](t.document),t.fire("saveSnapshot")},onRender:function(){t.on("selectionChange",function(e){var t=this.getValue(),n=e.data.path,r=n.elements;for(var s=0,o=r.length,u;s<o;s++){u=r[s];for(var a in i)if(i[a].checkElementRemovable(u,!0)){a!=t&&this.setValue(a);return}}this.setValue("")},this)},onOpen:function(){(CKEDITOR.env.ie||CKEDITOR.env.webkit)&&t.focus();var e=t.getSelection(),n=e.getSelectedElement(),s=new CKEDITOR.dom.elementPath(n||e.getStartElement()),o=[0,0,0,0];this.showAll(),this.unmarkAll();for(var u in i){var a=i[u],f=a.type;a.checkActive(s)?this.mark(u):f==CKEDITOR.STYLE_OBJECT&&!a.checkApplicable(s)&&(this.hideItem(u),o[f]--),o[f]++}o[CKEDITOR.STYLE_BLOCK]||this.hideGroup(r["panelTitle"+String(CKEDITOR.STYLE_BLOCK)]),o[CKEDITOR.STYLE_INLINE]||this.hideGroup(r["panelTitle"+String(CKEDITOR.STYLE_INLINE)]),o[CKEDITOR.STYLE_OBJECT]||this.hideGroup(r["panelTitle"+String(CKEDITOR.STYLE_OBJECT)])},reset:function(){o&&(delete o._.panel,delete o._.list,o._.committed=0,o._.items={},o._.state=CKEDITOR.TRISTATE_OFF),i={},s=[],u()}}),t.on("instanceReady",function(){u()})}})})();