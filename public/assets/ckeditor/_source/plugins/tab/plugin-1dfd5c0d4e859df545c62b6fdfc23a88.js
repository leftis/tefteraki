/*
Copyright (c) 2003-2012, CKSource - Frederico Knabben. All rights reserved.
For licensing, see LICENSE.html or http://ckeditor.com/license
*/
(function(){function r(e){return{editorFocus:!1,canUndo:!1,modes:{wysiwyg:1},exec:function(t){if(t.focusManager.hasFocus){var n=t.getSelection(),r=n.getCommonAncestor(),i;if(i=r.getAscendant("td",!0)||r.getAscendant("th",!0)){var s=new CKEDITOR.dom.range(t.document),o=CKEDITOR.tools.tryThese(function(){var t=i.getParent(),n=t.$.cells[i.$.cellIndex+(e?-1:1)];return n.parentNode.parentNode,n},function(){var t=i.getParent(),n=t.getAscendant("table"),r=n.$.rows[t.$.rowIndex+(e?-1:1)];return r.cells[e?r.cells.length-1:0]});if(!o&&!e){var u=i.getAscendant("table").$,a=i.getParent().$.cells,f=new CKEDITOR.dom.element(u.insertRow(-1),t.document);for(var l=0,c=a.length;l<c;l++){var h=f.append((new CKEDITOR.dom.element(a[l],t.document)).clone(!1,!1));!CKEDITOR.env.ie&&h.appendBogus()}s.moveToElementEditStart(f)}else{if(!o)return!0;o=new CKEDITOR.dom.element(o),s.moveToElementEditStart(o),(!s.checkStartOfBlock()||!s.checkEndOfBlock())&&s.selectNodeContents(o)}return s.select(!0),!0}}return!1}}}var e={editorFocus:!1,modes:{wysiwyg:1,source:1}},t={exec:function(e){e.container.focusNext(!0,e.tabIndex)}},n={exec:function(e){e.container.focusPrevious(!0,e.tabIndex)}};CKEDITOR.plugins.add("tab",{requires:["keystrokes"],init:function(i){var s=i.config.enableTabKeyTools!==!1,o=i.config.tabSpaces||0,u="";while(o--)u+="Â ";u&&i.on("key",function(e){e.data.keyCode==9&&(i.insertHtml(u),e.cancel())}),s&&i.on("key",function(e){(e.data.keyCode==9&&i.execCommand("selectNextCell")||e.data.keyCode==CKEDITOR.SHIFT+9&&i.execCommand("selectPreviousCell"))&&e.cancel()}),(CKEDITOR.env.webkit||CKEDITOR.env.gecko)&&i.on("key",function(e){var t=e.data.keyCode;t==9&&!u&&(e.cancel(),i.execCommand("blur")),t==CKEDITOR.SHIFT+9&&(i.execCommand("blurBack"),e.cancel())}),i.addCommand("blur",CKEDITOR.tools.extend(t,e)),i.addCommand("blurBack",CKEDITOR.tools.extend(n,e)),i.addCommand("selectNextCell",r()),i.addCommand("selectPreviousCell",r(!0))}})})(),CKEDITOR.dom.element.prototype.focusNext=function(e,t){var n=this.$,r=t===undefined?this.getTabIndex():t,i,s,o,u,a,f;if(r<=0){a=this.getNextSourceNode(e,CKEDITOR.NODE_ELEMENT);while(a){if(a.isVisible()&&a.getTabIndex()===0){o=a;break}a=a.getNextSourceNode(!1,CKEDITOR.NODE_ELEMENT)}}else{a=this.getDocument().getBody().getFirst();while(a=a.getNextSourceNode(!1,CKEDITOR.NODE_ELEMENT)){if(!i)if(!s&&a.equals(this)){s=!0;if(e){if(!(a=a.getNextSourceNode(!0,CKEDITOR.NODE_ELEMENT)))break;i=1}}else s&&!this.contains(a)&&(i=1);if(!a.isVisible()||(f=a.getTabIndex())<0)continue;if(i&&f==r){o=a;break}f>r&&(!o||!u||f<u)?(o=a,u=f):!o&&f===0&&(o=a,u=f)}}o&&o.focus()},CKEDITOR.dom.element.prototype.focusPrevious=function(e,t){var n=this.$,r=t===undefined?this.getTabIndex():t,i,s,o,u=0,a,f=this.getDocument().getBody().getLast();while(f=f.getPreviousSourceNode(!1,CKEDITOR.NODE_ELEMENT)){if(!i)if(!s&&f.equals(this)){s=!0;if(e){if(!(f=f.getPreviousSourceNode(!0,CKEDITOR.NODE_ELEMENT)))break;i=1}}else s&&!this.contains(f)&&(i=1);if(!f.isVisible()||(a=f.getTabIndex())<0)continue;if(r<=0){if(i&&a===0){o=f;break}a>u&&(o=f,u=a)}else{if(i&&a==r){o=f;break}a<r&&(!o||a>u)&&(o=f,u=a)}}o&&o.focus()};