/*
Copyright (c) 2003-2012, CKSource - Frederico Knabben. All rights reserved.
For licensing, see LICENSE.html or http://ckeditor.com/license
*/
(function(){function n(e){return CKEDITOR.env.ie?e.$.clientWidth:parseInt(e.getComputedStyle("width"),10)}function r(e,t){var n=e.getComputedStyle("border-"+t+"-width"),r={thin:"0px",medium:"1px",thick:"2px"};return n.indexOf("px")<0&&(n in r&&e.getComputedStyle("border-style")!="none"?n=r[n]:n=0),parseInt(n,10)}function i(e){var t=e.$.rows,n=0,r,i,s;for(var o=0,u=t.length;o<u;o++)s=t[o],r=s.cells.length,r>n&&(n=r,i=s);return i}function s(e){var t=[],n=-1,s=e.getComputedStyle("direction")=="rtl",o=i(e),u=new CKEDITOR.dom.element(e.$.tBodies[0]),a=u.getDocumentPosition();for(var f=0,l=o.cells.length;f<l;f++){var c=new CKEDITOR.dom.element(o.cells[f]),h=o.cells[f+1]&&new CKEDITOR.dom.element(o.cells[f+1]);n+=c.$.colSpan||1;var p,d,v,m=c.getDocumentPosition().x;s?d=m+r(c,"left"):p=m+c.$.offsetWidth-r(c,"right"),h?(m=h.getDocumentPosition().x,s?p=m+h.$.offsetWidth-r(h,"right"):d=m+r(h,"left")):(m=e.getDocumentPosition().x,s?p=m:d=m+e.$.offsetWidth),v=Math.max(d-p,3),t.push({table:e,index:n,x:p,y:a.y,width:v,height:u.$.offsetHeight,rtl:s})}return t}function o(e,t){for(var n=0,r=e.length;n<r;n++){var i=e[n];if(t>=i.x&&t<=i.x+i.width)return i}return null}function u(e){(e.data||e).preventDefault()}function a(i){function m(){s=null,c=0,f=0,o.removeListener("mouseup",E),a.removeListener("mousedown",w),a.removeListener("mousemove",S),o.getBody().setStyle("cursor","auto"),t?a.remove():a.hide()}function g(){var e=s.index,t=CKEDITOR.tools.buildTableMap(s.table),r=[],i=[],m=Number.MAX_VALUE,g=m,y=s.rtl;for(var b=0,w=t.length;b<w;b++){var E=t[b],x=E[e+(y?1:0)],T=E[e+(y?0:1)];x=x&&new CKEDITOR.dom.element(x),T=T&&new CKEDITOR.dom.element(T);if(!x||!T||!x.equals(T))x&&(m=Math.min(m,n(x))),T&&(g=Math.min(g,n(T))),r.push(x),i.push(T)}h=r,p=i,d=s.x-m,v=s.x+g,a.setOpacity(.5),l=parseInt(a.getStyle("left"),10),c=0,f=1,a.on("mousemove",S),o.on("dragstart",u)}function y(){f=0,a.setOpacity(0),c&&b();var e=s.table;setTimeout(function(){e.removeCustomData("_cke_table_pillars")},0),o.removeListener("dragstart",u)}function b(){var t=s.rtl,i=t?p.length:h.length;for(var o=0;o<i;o++){var u=h[o],a=p[o],f=s.table;CKEDITOR.tools.setTimeout(function(n,r,i,s,o,u){n&&n.setStyle("width",e(Math.max(r+u,0))),i&&i.setStyle("width",e(Math.max(s-u,0))),o&&f.setStyle("width",e(o+u*(t?-1:1)))},0,this,[u,u&&n(u),a,a&&n(a),(!u||!a)&&n(f)+r(f,"left")+r(f,"right"),c])}}function w(e){u(e),g(),o.on("mouseup",E,this)}function E(e){e.removeListener(),y()}function S(e){x(e.data.getPageOffset().x)}var s,o,a,f,l,c,h,p,d,v;o=i.document,a=CKEDITOR.dom.element.createFromHtml('<div data-cke-temp=1 contenteditable=false unselectable=on style="position:absolute;cursor:col-resize;filter:alpha(opacity=0);opacity:0;padding:0;background-color:#004;background-image:none;border:0px none;z-index:10"></div>',o),t||o.getDocumentElement().append(a),this.attachTo=function(n){if(f)return;t&&(o.getBody().append(a),c=0),s=n,a.setStyles({width:e(n.width),height:e(n.height),left:e(n.x),top:e(n.y)}),t&&a.setOpacity(.25),a.on("mousedown",w,this),o.getBody().setStyle("cursor","col-resize"),a.show()};var x=this.move=function(t){if(!s)return 0;if(!f&&(t<s.x||t>s.x+s.width))return m(),0;var n=t-Math.round(a.$.offsetWidth/2);if(f){if(n==d||n==v)return 1;n=Math.max(n,d),n=Math.min(n,v),c=n-l}return a.setStyle("left",e(n)),1}}function f(e){var t=e.data.getTarget();if(e.name=="mouseout"){if(!t.is("table"))return;var n=new CKEDITOR.dom.element(e.data.$.relatedTarget||e.data.$.toElement);while(n&&n.$&&!n.equals(t)&&!n.is("body"))n=n.getParent();if(!n||n.equals(t))return}t.getAscendant("table",1).removeCustomData("_cke_table_pillars"),e.removeListener()}var e=CKEDITOR.tools.cssLength,t=CKEDITOR.env.ie&&(CKEDITOR.env.ie7Compat||CKEDITOR.env.quirks||CKEDITOR.env.version<7);CKEDITOR.plugins.add("tableresize",{requires:["tabletools"],init:function(e){e.on("contentDom",function(){var t;e.document.getBody().on("mousemove",function(n){n=n.data;var r=n.getPageOffset().x;if(t&&t.move(r)){u(n);return}var i=n.getTarget(),l,c;if(!i.is("table")&&!i.getAscendant("tbody",1))return;l=i.getAscendant("table",1),(c=l.getCustomData("_cke_table_pillars"))||(l.setCustomData("_cke_table_pillars",c=s(l)),l.on("mouseout",f),l.on("mousedown",f));var h=o(c,r);h&&(!t&&(t=new a(e)),t.attachTo(h))})})}})})();